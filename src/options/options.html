<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Universal Request Analyzer - Config</title>
  <link rel="stylesheet" href="../css/themes.css">
  <link rel="stylesheet" href="../assets/fontawesome/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="css/options.css">
  <link rel="stylesheet" href="css/data-purge.css">
  <script src="../lib/shared-theme-init.js"></script>
</head>

<body>
  <div id="app" class="dashboard-layout">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="../assets/icons/icon48.png" alt="URA" class="sidebar-logo">
        <h1 class="sidebar-title">URA Dashboard</h1>
      </div>
      
      <nav class="sidebar-nav">
        <button class="nav-item active" data-tab="dashboard">
          <i class="fas fa-chart-line"></i>
          <span>Dashboard</span>
        </button>
        <button class="nav-item" data-tab="general">
          <i class="fas fa-cog"></i>
          <span>General</span>
        </button>
        <button class="nav-item" data-tab="monitoring">
          <i class="fas fa-chart-bar"></i>
          <span>Monitoring</span>
        </button>
        <button class="nav-item" data-tab="filters">
          <i class="fas fa-filter"></i>
          <span>Filters</span>
        </button>
        <button class="nav-item" data-tab="export">
          <i class="fas fa-file-export"></i>
          <span>Export</span>
        </button>
        <button class="nav-item" data-tab="retention">
          <i class="fas fa-database"></i>
          <span>Data Retention</span>
        </button>
        <button class="nav-item" data-tab="security">
          <i class="fas fa-shield-alt"></i>
          <span>Security</span>
        </button>
        <button class="nav-item" data-tab="themes">
          <i class="fas fa-palette"></i>
          <span>Themes</span>
        </button>
        <button class="nav-item" data-tab="advanced">
          <i class="fas fa-code"></i>
          <span>Advanced</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <div class="version-info">
          <i class="fas fa-info-circle"></i>
          <span>Version 1.0.0</span>
        </div>
      </div>
    </aside>

    <!-- Main Content Area -->
    <div class="main-area">
      <header class="content-header">
        <h1 id="pageTitle">Dashboard</h1>
        <div class="header-actions">
          <button id="saveAllBtn" class="btn-primary">
            <i class="fas fa-save"></i> Save All
          </button>
        </div>
      </header>

      <main class="content-body">
      <!-- Dashboard Tab -->
      <section id="dashboard" class="tab-content active">
        <div class="dashboard-container">
          <div class="dashboard-header">
            <h2><i class="fas fa-tachometer-alt"></i> Performance Dashboard</h2>
            <div class="dashboard-controls">
              <label>
                <input type="checkbox" id="dashboardAutoRefresh" checked>
                <span>Auto-refresh (30s)</span>
              </label>
              <select id="dashboardTimeRange">
                <option value="3600">Last Hour</option>
                <option value="21600">Last 6 Hours</option>
                <option value="86400" selected>Last 24 Hours</option>
                <option value="604800">Last 7 Days</option>
              </select>
              <button id="dashboardRefresh" class="btn-primary">
                <i class="fas fa-sync-alt"></i> Refresh
              </button>
            </div>
          </div>

          <!-- Loading Indicator -->
          <div id="dashboardLoading" class="loading-indicator" style="display: none;">
            <i class="fas fa-spinner fa-spin"></i> Loading dashboard data...
          </div>

          <!-- Key Metrics Cards -->
          <div class="metrics-grid">
            <div class="metric-card">
              <div class="metric-icon" style="background: #4CAF50;">
                <i class="fas fa-network-wired"></i>
              </div>
              <div class="metric-content">
                <div class="metric-label">Total Requests</div>
                <div class="metric-value" id="dashTotalRequests">0</div>
                <div class="metric-change positive" id="dashTotalChange">+0%</div>
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-icon" style="background: #2196F3;">
                <i class="fas fa-clock"></i>
              </div>
              <div class="metric-content">
                <div class="metric-label">Avg Response Time</div>
                <div class="metric-value" id="dashAvgResponse">0ms</div>
                <div class="metric-change" id="dashAvgChange">+0%</div>
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-icon" style="background: #FF9800;">
                <i class="fas fa-exclamation-triangle"></i>
              </div>
              <div class="metric-content">
                <div class="metric-label">Slow Requests</div>
                <div class="metric-value" id="dashSlowRequests">0</div>
                <div class="metric-change" id="dashSlowChange">+0%</div>
              </div>
            </div>

            <div class="metric-card">
              <div class="metric-icon" style="background: #f44336;">
                <i class="fas fa-times-circle"></i>
              </div>
              <div class="metric-content">
                <div class="metric-label">Error Rate</div>
                <div class="metric-value" id="dashErrorRate">0%</div>
                <div class="metric-change" id="dashErrorChange">+0%</div>
              </div>
            </div>
          </div>

          <!-- Charts Section -->
          <div class="dashboard-charts">
            <div class="chart-section">
              <h3><i class="fas fa-chart-line"></i> Request Volume Over Time</h3>
              <canvas id="dashboardVolumeChart"></canvas>
            </div>

            <div class="chart-row">
              <div class="chart-section half">
                <h3><i class="fas fa-chart-pie"></i> Status Distribution</h3>
                <canvas id="dashboardStatusChart"></canvas>
              </div>

              <div class="chart-section half">
                <h3><i class="fas fa-chart-bar"></i> Top Domains</h3>
                <canvas id="dashboardDomainsChart"></canvas>
              </div>
            </div>

            <div class="chart-section">
              <h3><i class="fas fa-chart-area"></i> Performance Trends</h3>
              <canvas id="dashboardPerformanceChart"></canvas>
            </div>
          </div>

          <!-- Data Layer Status -->
          <div class="data-layer-status">
            <h3><i class="fas fa-layer-group"></i> Medallion Architecture Status</h3>
            <div class="layer-cards">
              <div class="layer-card bronze">
                <div class="layer-name">Bronze Layer</div>
                <div class="layer-count" id="bronzeCount">0</div>
                <div class="layer-desc">Raw requests</div>
              </div>
              <div class="layer-card silver">
                <div class="layer-name">Silver Layer</div>
                <div class="layer-count" id="silverCount">0</div>
                <div class="layer-desc">Processed requests</div>
              </div>
              <div class="layer-card gold">
                <div class="layer-name">Gold Layer</div>
                <div class="layer-count" id="goldCount">0</div>
                <div class="layer-desc">Analytics</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- General Settings Tab -->
      <section id="general" class="tab-content">
        <div class="options-container">
          <div class="option-section">
            <h2>Capture Settings</h2>
            <div class="option-row">
              <label>
                <input type="checkbox" id="captureEnabled">
                Enable Request Capture
              </label>
              <span id="captureStatus" class="status-indicator"></span>
            </div>
            <div class="option-row">
              <label for="maxStoredRequests">Maximum Stored Requests:</label>
              <input type="number" id="maxStoredRequests" min="100" max="100000" step="100">
              <div class="storage-usage">
                <span id="currentStorageCount">0</span> / <span id="maxStorageDisplay">10,000</span> requests
                <div class="usage-bar">
                  <div id="usageBarFill" class="usage-bar-fill" style="width: 0%"></div>
                </div>
              </div>
            </div>
            <div class="option-row">
              <label>Quick Presets:</label>
              <div class="preset-buttons">
                <button class="preset-btn" data-value="1000">Light (1K)</button>
                <button class="preset-btn" data-value="10000">Medium (10K)</button>
                <button class="preset-btn" data-value="50000">Heavy (50K)</button>
                <button class="preset-btn" data-value="100000">Max (100K)</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Monitoring Settings Tab -->
      <section id="monitoring" class="tab-content">
        <div class="options-container">
          <div class="option-section">
            <h2>Visualization</h2>
            <div class="option-row">
              <label>
                <input type="checkbox" id="plotEnabled">
                Enable Plots
              </label>
            </div>
            <div class="option-row">
              <label>Plot Types:</label>
              <div class="checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" name="plotType" value="responseTime"> Response Time
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="plotType" value="statusCodes"> Status Codes
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="plotType" value="domains"> Domains
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="plotType" value="requestTypes"> Request Types
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="plotType" value="timeDistribution"> Time Distribution
                </label>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Filters Settings Tab -->
      <section id="filters" class="tab-content">
        <div class="options-container">
          <div class="option-section">
            <h2>Capture Filters</h2>
            <p class="description">Configure what requests to capture. Changes are automatically applied to all visualizations.</p>
            
            <div class="filter-auto-apply">
              <label>
                <input type="checkbox" id="autoApplyFilters" checked>
                <span>Auto-apply filters to all visualizations</span>
              </label>
              <span class="status-indicator active" id="filterApplyStatus"></span>
            </div>

            <h3><i class="fas fa-network-wired"></i> Request Types</h3>
            <div class="option-row">
              <label>Request Types to Capture:</label>
              <div class="checkbox-group">
                <label class="checkbox-label">
                  <input type="checkbox" name="captureType" value="xmlhttprequest"> XHR
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="captureType" value="fetch"> Fetch
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="captureType" value="script"> Script
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="captureType" value="stylesheet"> Stylesheet
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="captureType" value="image"> Image
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="captureType" value="font"> Font
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="captureType" value="other"> Other
                </label>
              </div>
            </div>

            <h3><i class="fas fa-globe"></i> Domain Filters</h3>
            <div class="option-row">
              <label for="includeDomains">Include Domains (comma separated):</label>
              <input type="text" id="includeDomains" placeholder="example.com, api.example.com (leave empty for all)">
              <span id="includeDomainsError" class="error-message"></span>
              <p class="help-text">Wildcard support: *.example.com matches all subdomains</p>
            </div>
            <div class="option-row">
              <label for="excludeDomains">Exclude Domains (comma separated):</label>
              <input type="text" id="excludeDomains" placeholder="cdn.com, analytics.com (leave empty for none)">
              <span id="excludeDomainsError" class="error-message"></span>
              <p class="help-text">Wildcard support: *.analytics.com matches all subdomains</p>
            </div>

            <h3><i class="fas fa-cogs"></i> Advanced Filters</h3>
            <div class="option-row">
              <label for="urlPattern">URL Pattern (Regex):</label>
              <input type="text" id="urlPattern" placeholder="/api/.*|/graphql.*">
              <span id="urlPatternError" class="error-message"></span>
              <p class="help-text">JavaScript regex pattern to match request URLs</p>
            </div>
            
            <div class="option-row">
              <label>HTTP Status Codes:</label>
              <div class="status-filter-group">
                <label class="checkbox-label">
                  <input type="checkbox" name="statusFilter" value="2xx" checked> 2xx Success
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="statusFilter" value="3xx" checked> 3xx Redirect
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="statusFilter" value="4xx" checked> 4xx Client Error
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="statusFilter" value="5xx" checked> 5xx Server Error
                </label>
              </div>
            </div>

            <div class="option-row">
              <label for="minResponseTime">Min Response Time (ms):</label>
              <input type="number" id="minResponseTime" min="0" placeholder="0">
            </div>

            <div class="option-row">
              <label for="maxResponseTime">Max Response Time (ms):</label>
              <input type="number" id="maxResponseTime" min="0" placeholder="Leave empty for no limit">
            </div>

            <div class="option-row">
              <label for="minSize">Min Response Size (bytes):</label>
              <input type="number" id="minSize" min="0" placeholder="0">
            </div>

            <div class="option-row">
              <label for="maxSize">Max Response Size (bytes):</label>
              <input type="number" id="maxSize" min="0" placeholder="Leave empty for no limit">
            </div>

            <h3><i class="fas fa-flask"></i> Filter Actions</h3>
            <div class="option-row">
              <button id="testFiltersBtn" class="secondary-btn">
                <i class="fas fa-vial"></i> Test Filters
              </button>
              <button id="applyFiltersBtn" class="btn-primary">
                <i class="fas fa-check"></i> Apply to Visualizations
              </button>
              <button id="clearFiltersBtn" class="secondary-btn">
                <i class="fas fa-eraser"></i> Clear All Filters
              </button>
              <span id="filterTestResult" class="help-text"></span>
            </div>
            
            <div class="option-row">
              <label>Filter Presets:</label>
              <div class="preset-buttons">
                <button class="filter-preset-btn" data-preset="api">API Only</button>
                <button class="filter-preset-btn" data-preset="noImages">No Images/Fonts</button>
                <button class="filter-preset-btn" data-preset="errors">Errors Only</button>
                <button class="filter-preset-btn" data-preset="slow">Slow Requests</button>
                <button class="filter-preset-btn" data-preset="all">Capture All</button>
              </div>
            </div>

            <div class="filter-status-box">
              <h4><i class="fas fa-info-circle"></i> Active Filters Summary</h4>
              <div id="activeFiltersSummary">
                <p class="placeholder">No filters applied. Showing all requests.</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Export Settings Tab -->
      <section id="export" class="tab-content">
        <div class="options-container">
          <div class="option-section">
            <h2>Manual Export</h2>
            <div class="option-row">
              <button id="exportNowBtn" class="btn-primary">
                <i class="fas fa-download"></i> Export Now
              </button>
              <select id="manualExportFormat">
                <option value="json">JSON</option>
                <option value="csv">CSV</option>
                <option value="sqlite">SQLite</option>
              </select>
              <p class="description">Immediately export all collected data</p>
            </div>
            <div class="option-row">
              <label>Last Export:</label>
              <span id="lastExportTime">Never</span>
            </div>
          </div>

          <div class="option-section">
            <h2>Auto Export</h2>
            <div class="option-row">
              <label>
                <input type="checkbox" id="autoExport">
                Enable Auto Export
              </label>
              <span id="autoExportStatus" class="status-indicator"></span>
            </div>
            <div class="option-row">
              <label for="exportFormat">Export Format:</label>
              <select id="exportFormat">
                <option value="json">JSON</option>
                <option value="csv">CSV</option>
                <option value="sqlite">SQLite</option>
              </select>
            </div>
            <div class="option-row">
              <label for="exportInterval">Export Interval (minutes):</label>
              <input type="number" id="exportInterval" min="5" max="1440" step="5">
              <span class="help-text">Next export in: <span id="nextExportTime">--</span></span>
            </div>
            <div class="option-row">
              <label for="exportPath">Export Directory (optional):</label>
              <input type="text" id="exportPath" placeholder="Default downloads directory">
            </div>
          </div>
        </div>
      </section>

      <!-- Data Retention Tab -->
      <section id="retention" class="tab-content">
        <div id="dataPurge"></div>
      </section>

      <!-- Security Settings Tab -->
      <section id="security" class="tab-content">
        <div class="options-container">
          <div class="option-section">
            <h2>Settings Import/Export</h2>
            <div class="option-row">
              <button id="exportSettingsBtn" class="primary-btn">
                Export Settings
              </button>
              <p class="description">Export all settings to a file for backup or transfer</p>
            </div>
            <div class="option-row">
              <input type="file" id="importSettingsFile" accept=".json" style="display: none;">
              <button id="importSettingsBtn" class="secondary-btn">
                Import Settings
              </button>
              <p class="description">Import settings from a previously exported file</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Themes Settings Tab -->
      <section id="themes" class="tab-content">
        <div class="options-container">
          <div class="option-section">
            <h2>Theme Settings</h2>
            <div class="option-row">
              <label for="currentTheme">Current Theme:</label>
              <select id="currentTheme">
                <option value="system">System Preference</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="highContrast">High Contrast</option>
                <option value="blue">Blue</option>
              </select>
            </div>

            <h3>Available Themes</h3>
            <div class="themes-container">
              <!-- Theme cards will be added dynamically -->
            </div>

            <div class="option-row actions">
              <button id="saveThemeBtn" class="primary-btn">Save Changes</button>
              <button id="resetThemeBtn" class="secondary-btn">Reset to Default</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Advanced Tab -->
      <section id="advanced" class="tab-content">
        <div class="options-container">
          <div class="option-section">
            <h2>Advanced Features</h2>
            <p class="description">Advanced debugging and database management tools</p>

            <h3><i class="fas fa-database"></i> Database Management</h3>
            
            <div class="option-row">
              <label>Database Location:</label>
              <code>IndexedDB: ura_medallion_db</code>
            </div>

            <div class="option-row">
              <label>Database Size:</label>
              <span id="advancedDbSize">Calculating...</span>
            </div>

            <div class="option-row">
              <label>Total Records:</label>
              <div class="db-layer-stats">
                <div class="stat-item">
                  <span class="stat-label">Bronze:</span>
                  <span id="advancedBronzeCount">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Silver:</span>
                  <span id="advancedSilverCount">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Gold:</span>
                  <span id="advancedGoldCount">0</span>
                </div>
              </div>
            </div>

            <h3><i class="fas fa-search"></i> Direct Database Query</h3>
            <div class="query-section">
              <div class="option-row">
                <label for="advancedQuery">SQL Query:</label>
                <textarea id="advancedQuery" rows="5" placeholder="SELECT * FROM bronze_requests LIMIT 10"></textarea>
              </div>
              <div class="option-row">
                <button id="executeQueryBtn" class="primary-btn">
                  <i class="fas fa-play"></i> Execute Query
                </button>
                <button id="clearQueryBtn" class="secondary-btn">
                  <i class="fas fa-eraser"></i> Clear
                </button>
              </div>
              <div class="option-row">
                <label>Query Result:</label>
                <div id="queryResult" class="query-result">
                  <p class="placeholder">Execute a query to see results...</p>
                </div>
              </div>
            </div>

            <h3><i class="fas fa-tools"></i> Debug Tools</h3>
            <div class="debug-actions">
              <div class="option-row">
                <button id="inspectSchemaBtn" class="secondary-btn">
                  <i class="fas fa-table"></i> Inspect Database Schema
                </button>
                <p class="description">View all tables and their structures</p>
              </div>
              <div class="option-row">
                <button id="viewLogsBtn" class="secondary-btn">
                  <i class="fas fa-file-alt"></i> View Extension Logs
                </button>
                <p class="description">Open browser console to view logs</p>
              </div>
              <div class="option-row">
                <button id="testConnectionBtn" class="secondary-btn">
                  <i class="fas fa-plug"></i> Test Background Connection
                </button>
                <p class="description">Verify connection to background script</p>
              </div>
              <div class="option-row">
                <button id="forceProcessBtn" class="warning-btn">
                  <i class="fas fa-sync"></i> Force Data Processing
                </button>
                <p class="description">Manually trigger Bronze→Silver→Gold processing</p>
              </div>
            </div>

            <h3><i class="fas fa-download"></i> Advanced Export</h3>
            <div class="option-row">
              <button id="exportRawDbBtn" class="primary-btn">
                <i class="fas fa-download"></i> Export Raw SQLite Database
              </button>
              <p class="description">Download the entire database as SQLite file</p>
            </div>

            <h3><i class="fas fa-exclamation-triangle"></i> Danger Zone</h3>
            <div class="danger-zone">
              <div class="option-row">
                <button id="resetDatabaseBtn" class="danger-btn">
                  <i class="fas fa-trash-alt"></i> Reset Database
                </button>
                <p class="description">Delete all data and recreate database schema</p>
              </div>
              <div class="option-row">
                <button id="clearCacheBtn" class="danger-btn">
                  <i class="fas fa-broom"></i> Clear Extension Cache
                </button>
                <p class="description">Clear all cached data and force reload</p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    </div>
  </div>

  <div id="notification" class="notification"></div>

  <script type="module" src="js/options.js"></script>
</body>

</html>