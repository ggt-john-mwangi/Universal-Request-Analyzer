<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Universal Request Analyzer - Config</title>
    <link rel="stylesheet" href="../css/themes.css" />
    <link rel="stylesheet" href="../assets/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="css/options.css" />
    <link rel="stylesheet" href="css/data-purge.css" />
    <script src="../lib/shared-theme-init.js"></script>
  </head>

  <body>
    <div id="app" class="dashboard-layout">
      <!-- Sidebar Navigation -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <img
            src="../assets/icons/icon48.png"
            alt="URA"
            class="sidebar-logo"
          />
          <h1 class="sidebar-title">URA Dashboard</h1>
        </div>

        <nav class="sidebar-nav">
          <button class="nav-item active" data-tab="dashboard">
            <i class="fas fa-chart-line"></i>
            <span>Dashboard</span>
          </button>
          <button class="nav-item" data-tab="runners">
            <i class="fas fa-play-circle"></i>
            <span>Runners</span>
          </button>
          <button class="nav-item" data-tab="general">
            <i class="fas fa-cog"></i>
            <span>General</span>
          </button>
          <button class="nav-item" data-tab="alerts">
            <i class="fas fa-bell"></i>
            <span>Alerts</span>
          </button>
          <button class="nav-item" data-tab="export">
            <i class="fas fa-file-export"></i>
            <span>Export</span>
          </button>
          <button class="nav-item" data-tab="retention">
            <i class="fas fa-database"></i>
            <span>Data</span>
          </button>
          <button class="nav-item" data-tab="security">
            <i class="fas fa-shield-alt"></i>
            <span>Security</span>
          </button>
          <button class="nav-item" data-tab="themes">
            <i class="fas fa-palette"></i>
            <span>Themes</span>
          </button>
          <button class="nav-item" data-tab="variables">
            <i class="fas fa-dollar-sign"></i>
            <span>Variables</span>
          </button>
          <button class="nav-item" data-tab="advanced">
            <i class="fas fa-code"></i>
            <span>Advanced</span>
          </button>
        </nav>

        <div class="sidebar-footer">
          <div class="version-info">
            <i class="fas fa-info-circle"></i>
            <span>Version 1.0.0</span>
          </div>
        </div>
      </aside>

      <!-- Main Content Area -->
      <div class="main-area">
        <header class="content-header">
          <h1 id="pageTitle">Dashboard</h1>
          <div class="header-actions">
            <button id="saveAllBtn" class="btn-primary">
              <i class="fas fa-save"></i> Save All
            </button>
          </div>
        </header>

        <main class="content-body">
          <!-- Dashboard Tab -->
          <section id="dashboard" class="tab-content active">
            <div class="dashboard-container">
              <div class="dashboard-header">
                <h2>
                  <i class="fas fa-tachometer-alt"></i> Dashboard
                  <span
                    style="
                      font-size: 12px;
                      font-weight: normal;
                      color: var(--text-secondary-color, #718096);
                      margin-left: 8px;
                    "
                  >
                    (Analytics & Performance)
                  </span>
                </h2>
                <div class="dashboard-controls">
                  <button
                    id="dashboardFilterToggle"
                    class="filter-toggle-btn"
                    title="Toggle Filters"
                  >
                    <i class="fas fa-filter"></i> Filters
                    <i class="fas fa-chevron-down toggle-icon"></i>
                  </button>
                  <label>
                    <input type="checkbox" id="dashboardAutoRefresh" checked />
                    <span>Auto-refresh</span>
                  </label>
                  <select id="dashboardTimeRange">
                    <option value="1800">Last 30 minutes</option>
                    <option value="3600">Last 1 hour</option>
                    <option value="21600">Last 6 hours</option>
                    <option value="86400" selected>Last 24 hours</option>
                    <option value="604800">Last 7 days</option>
                    <option value="2592000">Last 30 days</option>
                    <option value="7776000">Last 3 months</option>
                  </select>
                  <button id="dashboardRefresh" class="btn-primary">
                    <i class="fas fa-sync-alt"></i> Refresh
                  </button>
                </div>
              </div>

              <!-- Active Filters Info -->
              <div
                id="dashboardActiveFilters"
                class="active-filters-info"
                style="
                  display: none;
                  padding: 12px;
                  background: var(--info-light, #e3f2fd);
                  border: 1px solid var(--info-color, #2196f3);
                  border-radius: 4px;
                  margin-bottom: 16px;
                "
              >
                <div style="display: flex; align-items: center; gap: 8px">
                  <i
                    class="fas fa-info-circle"
                    style="color: var(--info-color, #2196f3)"
                  ></i>
                  <span
                    id="activeFiltersText"
                    style="color: var(--text-primary); font-size: 14px"
                  ></span>
                </div>
              </div>

              <!-- Collapsible Filter Panel -->
              <div id="dashboardFilterPanel" class="filter-panel">
                <div class="filter-panel-content">
                  <div class="filter-group">
                    <label>
                      <span><i class="fas fa-globe"></i> Domain:</span>
                      <select
                        id="dashboardDomainFilter"
                        style="min-width: 200px"
                      >
                        <option value="all">All Domains</option>
                      </select>
                    </label>
                  </div>
                  <div class="filter-group">
                    <label>
                      <span><i class="fas fa-file"></i> Page:</span>
                      <select id="dashboardPageFilter" style="min-width: 200px">
                        <option value="">All Pages (Aggregated)</option>
                      </select>
                    </label>
                  </div>
                  <div class="filter-group">
                    <label>
                      <span><i class="fas fa-filter"></i> Type:</span>
                      <select
                        id="dashboardRequestTypeFilter"
                        style="min-width: 120px"
                      >
                        <option value="">All Types</option>
                        <option value="xmlhttprequest">XHR/API</option>
                        <option value="fetch">Fetch</option>
                        <option value="script">Scripts</option>
                        <option value="stylesheet">Stylesheets</option>
                        <option value="image">Images</option>
                        <option value="font">Fonts</option>
                        <option value="document">Documents</option>
                        <option value="other">Other</option>
                      </select>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Loading Indicator -->
              <div
                id="dashboardLoading"
                class="loading-indicator"
                style="display: none"
              >
                <i class="fas fa-spinner fa-spin"></i> Loading dashboard data...
              </div>

              <!-- Key Metrics Cards -->
              <div class="metrics-grid">
                <div class="metric-card">
                  <div class="metric-icon success">
                    <i class="fas fa-network-wired"></i>
                  </div>
                  <div class="metric-content">
                    <div class="metric-label">Total Requests</div>
                    <div class="metric-value" id="dashTotalRequests">0</div>
                    <div class="metric-change positive" id="dashTotalChange">
                      +0%
                    </div>
                  </div>
                </div>

                <div class="metric-card">
                  <div class="metric-icon info">
                    <i class="fas fa-clock"></i>
                  </div>
                  <div class="metric-content">
                    <div class="metric-label">Avg Response Time</div>
                    <div class="metric-value" id="dashAvgResponse">0ms</div>
                    <div class="metric-change" id="dashAvgChange">+0%</div>
                  </div>
                </div>

                <div class="metric-card">
                  <div class="metric-icon warning">
                    <i class="fas fa-exclamation-triangle"></i>
                  </div>
                  <div class="metric-content">
                    <div class="metric-label">Slow Requests</div>
                    <div class="metric-value" id="dashSlowRequests">0</div>
                    <div class="metric-change" id="dashSlowChange">+0%</div>
                  </div>
                </div>

                <div class="metric-card">
                  <div class="metric-icon error">
                    <i class="fas fa-times-circle"></i>
                  </div>
                  <div class="metric-content">
                    <div class="metric-label">Error Rate</div>
                    <div class="metric-value" id="dashErrorRate">0%</div>
                    <div class="metric-change" id="dashErrorChange">+0%</div>
                  </div>
                </div>
              </div>

              <!-- Dashboard Sub-Tabs Navigation -->
              <div class="dashboard-tabs">
                <div class="tabs-nav">
                  <button data-tab="overview" class="dashboard-tab-btn active">
                    <i class="fas fa-chart-line"></i> Overview
                  </button>
                  <button data-tab="requests" class="dashboard-tab-btn">
                    <i class="fas fa-list"></i> Requests
                  </button>
                  <button data-tab="performance" class="dashboard-tab-btn">
                    <i class="fas fa-stopwatch"></i> Performance
                  </button>
                  <button data-tab="resources" class="dashboard-tab-btn">
                    <i class="fas fa-database"></i> Resources
                  </button>
                  <button data-tab="errors" class="dashboard-tab-btn">
                    <i class="fas fa-bug"></i> Errors
                  </button>
                  <button data-tab="analytics" class="dashboard-tab-btn">
                    <i class="fas fa-chart-bar"></i> Analytics
                  </button>
                </div>

                <!-- Overview Tab -->
                <div
                  class="dashboard-tab-content active"
                  data-tab-content="overview"
                >
                  <!-- Core Web Vitals Section -->
                  <div class="web-vitals-section">
                    <h3>
                      <i class="fas fa-tachometer-alt"></i> Core Web Vitals
                    </h3>
                    <div class="web-vitals-grid">
                      <div class="vital-card" id="lcpCard">
                        <div class="vital-icon">
                          <i class="fas fa-image"></i>
                        </div>
                        <div class="vital-content">
                          <div class="vital-label">LCP</div>
                          <div class="vital-subtitle">
                            Largest Contentful Paint
                          </div>
                          <div class="vital-value" id="lcpValue">-</div>
                          <div class="vital-rating" id="lcpRating"></div>
                          <div class="vital-target">Target: &lt; 2.5s</div>
                        </div>
                      </div>

                      <div class="vital-card" id="fidCard">
                        <div class="vital-icon">
                          <i class="fas fa-mouse-pointer"></i>
                        </div>
                        <div class="vital-content">
                          <div class="vital-label">FID</div>
                          <div class="vital-subtitle">First Input Delay</div>
                          <div class="vital-value" id="fidValue">-</div>
                          <div class="vital-rating" id="fidRating"></div>
                          <div class="vital-target">Target: &lt; 100ms</div>
                        </div>
                      </div>

                      <div class="vital-card" id="clsCard">
                        <div class="vital-icon">
                          <i class="fas fa-arrows-alt"></i>
                        </div>
                        <div class="vital-content">
                          <div class="vital-label">CLS</div>
                          <div class="vital-subtitle">
                            Cumulative Layout Shift
                          </div>
                          <div class="vital-value" id="clsValue">-</div>
                          <div class="vital-rating" id="clsRating"></div>
                          <div class="vital-target">Target: &lt; 0.1</div>
                        </div>
                      </div>

                      <div class="vital-card" id="fcpCard">
                        <div class="vital-icon">
                          <i class="fas fa-paint-brush"></i>
                        </div>
                        <div class="vital-content">
                          <div class="vital-label">FCP</div>
                          <div class="vital-subtitle">
                            First Contentful Paint
                          </div>
                          <div class="vital-value" id="fcpValue">-</div>
                          <div class="vital-rating" id="fcpRating"></div>
                          <div class="vital-target">Target: &lt; 1.8s</div>
                        </div>
                      </div>

                      <div class="vital-card" id="ttfbCard">
                        <div class="vital-icon">
                          <i class="fas fa-server"></i>
                        </div>
                        <div class="vital-content">
                          <div class="vital-label">TTFB</div>
                          <div class="vital-subtitle">Time to First Byte</div>
                          <div class="vital-value" id="ttfbValue">-</div>
                          <div class="vital-rating" id="ttfbRating"></div>
                          <div class="vital-target">Target: &lt; 800ms</div>
                        </div>
                      </div>

                      <div class="vital-card" id="ttiCard">
                        <div class="vital-icon">
                          <i class="fas fa-hand-pointer"></i>
                        </div>
                        <div class="vital-content">
                          <div class="vital-label">TTI</div>
                          <div class="vital-subtitle">Time to Interactive</div>
                          <div class="vital-value" id="ttiValue">-</div>
                          <div class="vital-rating" id="ttiRating"></div>
                          <div class="vital-target">Target: &lt; 3.8s</div>
                        </div>
                      </div>

                      <div class="vital-card" id="dclCard">
                        <div class="vital-icon">
                          <i class="fas fa-file-code"></i>
                        </div>
                        <div class="vital-content">
                          <div class="vital-label">DCL</div>
                          <div class="vital-subtitle">DOMContentLoaded</div>
                          <div class="vital-value" id="dclValue">-</div>
                          <div class="vital-rating" id="dclRating"></div>
                          <div class="vital-target">Target: &lt; 1.5s</div>
                        </div>
                      </div>

                      <div class="vital-card" id="loadCard">
                        <div class="vital-icon">
                          <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="vital-content">
                          <div class="vital-label">Load</div>
                          <div class="vital-subtitle">Page Load Complete</div>
                          <div class="vital-value" id="loadValue">-</div>
                          <div class="vital-rating" id="loadRating"></div>
                          <div class="vital-target">Target: &lt; 2.5s</div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Charts Section -->
                  <div class="dashboard-charts">
                    <div class="chart-section">
                      <h3>
                        <i class="fas fa-chart-line"></i> Request Volume Over
                        Time
                      </h3>
                      <canvas id="dashboardVolumeChart"></canvas>
                    </div>

                    <div class="chart-row">
                      <div class="chart-section half">
                        <h3>
                          <i class="fas fa-chart-pie"></i> Status Distribution
                        </h3>
                        <canvas id="dashboardStatusChart"></canvas>
                      </div>

                      <div class="chart-section half">
                        <h3 id="dashboardDomainsChartLabel">
                          <i class="fas fa-chart-bar"></i> Top Domains
                        </h3>
                        <canvas id="dashboardDomainsChart"></canvas>
                      </div>
                    </div>

                    <div class="chart-section">
                      <h3>
                        <i class="fas fa-chart-area"></i> Performance Trends
                      </h3>
                      <canvas id="dashboardPerformanceChart"></canvas>
                    </div>
                  </div>
                </div>
                <!-- End Overview Tab -->

                <!-- Requests Tab -->
                <div class="dashboard-tab-content" data-tab-content="requests">
                  <!-- Requests Table Section -->
                  <div class="chart-section">
                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 12px;
                      "
                    >
                      <h3 style="margin: 0">
                        <i class="fas fa-list"></i> Requests Table
                      </h3>
                      <button id="dashboardExportHAR" class="btn-secondary">
                        <i class="fas fa-download"></i> Export HAR
                      </button>
                    </div>
                    <p
                      class="hint"
                      style="
                        font-size: 13px;
                        color: var(--text-secondary-color);
                        margin-bottom: 16px;
                      "
                    >
                      View detailed request information with search, pagination,
                      and cURL export capabilities.
                    </p>

                    <div
                      class="table-controls"
                      style="
                        display: flex;
                        gap: 12px;
                        margin-bottom: 16px;
                        flex-wrap: wrap;
                        justify-content: space-between;
                      "
                    >
                      <div
                        class="search-container"
                        style="flex: 1; max-width: 400px"
                      >
                        <i class="fas fa-search"></i>
                        <input
                          type="text"
                          id="dashboardSearchRequests"
                          placeholder="Search URLs, methods, status..."
                          class="search-input"
                        />
                      </div>
                      <select
                        id="dashboardRequestsPerPage"
                        class="filter-select"
                      >
                        <option value="10">10 per page</option>
                        <option value="25" selected>25 per page</option>
                        <option value="50">50 per page</option>
                        <option value="100">100 per page</option>
                      </select>
                    </div>

                    <!-- Request Runner Controls -->
                    <div
                      id="runnerControls"
                      style="
                        display: none;
                        margin: 16px 0;
                        padding: 12px;
                        background: var(--surface-color);
                        border: 1px solid var(--border-color);
                        border-radius: 8px;
                      "
                    >
                      <div
                        style="
                          display: flex;
                          align-items: center;
                          gap: 12px;
                          flex-wrap: wrap;
                        "
                      >
                        <span style="font-weight: 600"
                          ><span id="selectedRequestsCount">0</span>
                          selected</span
                        >
                        <button
                          id="btnRunSelectedRequests"
                          class="btn-primary"
                          style="margin: 0"
                        >
                          <i class="fas fa-play"></i> Run Selected
                        </button>
                        <button
                          id="btnClearSelection"
                          class="btn-secondary"
                          style="margin: 0"
                        >
                          <i class="fas fa-times"></i> Clear Selection
                        </button>
                        <button
                          id="btnRunnerHistory"
                          class="btn-secondary"
                          style="margin: 0"
                        >
                          <i class="fas fa-history"></i> History
                        </button>
                      </div>
                    </div>

                    <div
                      class="requests-table-container"
                      style="overflow-x: auto"
                    >
                      <table
                        id="dashboardRequestsTable"
                        class="data-table"
                        style="width: 100%; border-collapse: collapse"
                      >
                        <thead>
                          <tr>
                            <th
                              style="
                                width: 40px;
                                display: flex;
                                justify-content: flex-start;
                                align-items: center;
                              "
                            >
                              <input
                                type="checkbox"
                                id="selectAllRequests"
                                title="Select all"
                              />
                            </th>
                            <th>Method</th>
                            <th>URL</th>
                            <th>Status</th>
                            <th>Type</th>
                            <th>Time</th>
                            <th>Size</th>
                            <th>Actions</th>
                          </tr>
                        </thead>
                        <tbody id="dashboardRequestsTableBody">
                          <tr class="no-data-row">
                            <td
                              colspan="7"
                              style="
                                text-align: center;
                                padding: 24px;
                                color: var(--text-secondary-color);
                              "
                            >
                              No requests available. Select filters and refresh
                              to load data.
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>

                    <div
                      id="dashboardTablePagination"
                      class="table-pagination"
                      style="
                        margin-top: 16px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                      "
                    ></div>
                  </div>
                </div>
                <!-- End Requests Tab -->

                <!-- Performance Tab -->
                <div
                  class="dashboard-tab-content"
                  data-tab-content="performance"
                >
                  <p class="hint" style="margin-bottom: 16px">
                    <i class="fas fa-info-circle"></i> Track endpoint
                    performance, response times, and request trends over time.
                  </p>

                  <!-- Endpoint Performance Over Time -->
                  <div class="chart-section">
                    <div
                      style="
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 12px;
                      "
                    >
                      <h3 style="margin: 0">
                        <i class="fas fa-chart-line"></i> Endpoint Performance
                        Over Time
                      </h3>
                    </div>
                    <p
                      class="hint"
                      style="
                        font-size: 13px;
                        color: var(--text-secondary-color);
                        margin-bottom: 16px;
                      "
                    >
                      Track request types (fetch, xhr, script, etc.) or specific
                      API endpoints performance over time.
                    </p>

                    <div
                      class="history-controls"
                      style="
                        display: grid;
                        grid-template-columns: repeat(3, 1fr);
                        gap: 16px;
                        margin-bottom: 20px;
                      "
                    >
                      <!-- Row 1: Time Controls -->
                      <div class="filter-group">
                        <label
                          style="
                            display: block;
                            margin-bottom: 6px;
                            font-weight: 500;
                            font-size: 13px;
                          "
                        >
                          <i class="fas fa-clock"></i> Time Range
                        </label>
                        <select
                          id="dashboardEndpointTimeRange"
                          class="filter-select"
                          style="width: 100%"
                        >
                          <option value="30">Last 30 minutes</option>
                          <option value="60">Last 1 hour</option>
                          <option value="360">Last 6 hours</option>
                          <option value="1440" selected>Last 24 hours</option>
                          <option value="10080">Last 7 days</option>
                          <option value="43200">Last 30 days</option>
                          <option value="129600">Last 3 months</option>
                        </select>
                      </div>

                      <div class="filter-group">
                        <label
                          style="
                            display: block;
                            margin-bottom: 6px;
                            font-weight: 500;
                            font-size: 13px;
                          "
                        >
                          <i class="fas fa-filter"></i> Resource Type
                        </label>
                        <select
                          id="dashboardEndpointTypeFilter"
                          class="filter-select"
                          style="width: 100%"
                        >
                          <option value="">All Types</option>
                          <option value="fetch">Fetch</option>
                          <option value="xmlhttprequest">XHR/AJAX</option>
                          <option value="script">Script</option>
                          <option value="stylesheet">Stylesheet</option>
                          <option value="image">Image</option>
                          <option value="font">Font</option>
                          <option value="document">Document</option>
                          <option value="other">Other</option>
                        </select>
                      </div>

                      <!-- Row 2: Sorting & Filtering -->
                      <div class="filter-group">
                        <label
                          style="
                            display: block;
                            margin-bottom: 6px;
                            font-weight: 500;
                            font-size: 13px;
                          "
                        >
                          <i class="fas fa-sort"></i> Sort By
                        </label>
                        <select
                          id="dashboardEndpointSortBy"
                          class="filter-select"
                          style="width: 100%"
                        >
                          <option value="requests" selected>
                            Most Requests
                          </option>
                          <option value="slowest">Slowest Avg</option>
                          <option value="errors">Most Errors</option>
                          <option value="size">Largest Size</option>
                        </select>
                      </div>

                      <div class="filter-group">
                        <label
                          style="
                            display: block;
                            margin-bottom: 6px;
                            font-weight: 500;
                            font-size: 13px;
                          "
                        >
                          <i class="fas fa-list-ol"></i> Show Top
                        </label>
                        <select
                          id="dashboardEndpointTopN"
                          class="filter-select"
                          style="width: 100%"
                        >
                          <option value="5">Top 5</option>
                          <option value="10" selected>Top 10</option>
                          <option value="15">Top 15</option>
                          <option value="20">Top 20</option>
                          <option value="all">All Endpoints</option>
                        </select>
                      </div>

                      <div class="filter-group">
                        <label
                          style="
                            display: block;
                            margin-bottom: 6px;
                            font-weight: 500;
                            font-size: 13px;
                          "
                        >
                          <i class="fas fa-sync-alt"></i> Action
                        </label>
                        <button
                          id="dashboardLoadHistoryBtn"
                          class="btn-primary"
                          style="width: 100%; padding: 8px 16px; height: 36px"
                        >
                          <i class="fas fa-sync-alt"></i> Load Data
                        </button>
                      </div>

                      <!-- Row 3: Search (spans all columns) -->
                      <div class="filter-group" style="grid-column: span 3">
                        <label
                          style="
                            display: block;
                            margin-bottom: 6px;
                            font-weight: 500;
                            font-size: 13px;
                          "
                        >
                          <i class="fas fa-search"></i> Search Endpoint
                        </label>
                        <input
                          type="text"
                          id="dashboardEndpointPattern"
                          placeholder="Filter by URL pattern (e.g., /api/users, /login, /products/:id)"
                          class="modern-input"
                          style="width: 100%; padding: 8px 12px"
                        />
                      </div>
                    </div>

                    <!-- Endpoint Selection Panel (shows after loading) -->
                    <div
                      id="dashboardEndpointSelector"
                      style="
                        display: none;
                        margin-bottom: 16px;
                        padding: 12px;
                        background: var(--bg-secondary);
                        border-radius: 6px;
                        border: 1px solid var(--border-color);
                      "
                    >
                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          align-items: center;
                          margin-bottom: 8px;
                        "
                      >
                        <label
                          style="font-weight: 500; color: var(--text-primary)"
                        >
                          <i class="fas fa-chart-line"></i> Select Endpoints to
                          Plot (click to toggle):
                        </label>
                        <div style="display: flex; gap: 8px">
                          <button
                            id="dashboardSelectAllEndpoints"
                            class="btn-secondary"
                            style="padding: 4px 12px; font-size: 12px"
                          >
                            Select All
                          </button>
                          <button
                            id="dashboardDeselectAllEndpoints"
                            class="btn-secondary"
                            style="padding: 4px 12px; font-size: 12px"
                          >
                            Deselect All
                          </button>
                        </div>
                      </div>
                      <div
                        id="dashboardEndpointList"
                        style="
                          display: grid;
                          grid-template-columns: repeat(
                            auto-fill,
                            minmax(300px, 1fr)
                          );
                          gap: 8px;
                          max-height: 200px;
                          overflow-y: auto;
                        "
                      >
                        <!-- Populated dynamically -->
                      </div>
                    </div>

                    <div
                      id="dashboardPerformanceHistoryChart"
                      style="min-height: 300px; position: relative"
                    >
                      <canvas id="dashboardHistoryChartCanvas"></canvas>
                    </div>
                  </div>
                </div>
                <!-- End Performance Tab -->

                <!-- Resources Tab -->
                <div class="dashboard-tab-content" data-tab-content="resources">
                  <!-- Resource Breakdown Section -->
                  <div class="chart-section">
                    <h3>
                      <i class="fas fa-database"></i> Resource Size Breakdown
                    </h3>
                    <p
                      class="hint"
                      style="
                        font-size: 13px;
                        color: var(--text-secondary-color);
                        margin-bottom: 16px;
                      "
                    >
                      Analyze resource types, sizes, and potential compression
                      savings for the selected domain.
                    </p>

                    <div
                      style="
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 24px;
                        margin-bottom: 24px;
                      "
                    >
                      <div>
                        <h4 style="margin-bottom: 12px">
                          <i class="fas fa-chart-pie"></i> Size Distribution
                        </h4>
                        <div
                          id="dashboardResourceChartContainer"
                          style="min-height: 300px; position: relative"
                        >
                          <canvas id="dashboardResourcePieChart"></canvas>
                        </div>
                      </div>
                      <div>
                        <h4 style="margin-bottom: 12px">
                          <i class="fas fa-compress"></i> Compression Analysis
                        </h4>
                        <div
                          id="dashboardCompressionStats"
                          style="
                            padding: 16px;
                            background: var(--surface-color);
                            border-radius: 8px;
                          "
                        >
                          <p class="no-data">
                            No data available. Refresh Dashboard to load
                            resource stats.
                          </p>
                        </div>
                      </div>
                    </div>

                    <div
                      id="dashboardResourcesTable"
                      class="resources-table"
                    ></div>
                  </div>
                </div>
                <!-- End Resources Tab -->

                <!-- Errors Tab -->
                <div class="dashboard-tab-content" data-tab-content="errors">
                  <!-- Error Analysis Section -->
                  <div class="chart-section">
                    <h3><i class="fas fa-bug"></i> Error Analysis</h3>
                    <p
                      class="hint"
                      style="
                        font-size: 13px;
                        color: var(--text-secondary-color);
                        margin-bottom: 16px;
                      "
                    >
                      Analyze failed requests (4xx client errors and 5xx server
                      errors) for the selected domain.
                    </p>

                    <div
                      id="dashboardErrorCategories"
                      class="error-categories"
                      style="margin-bottom: 24px"
                    ></div>

                    <div
                      style="
                        display: grid;
                        grid-template-columns: 2fr 1fr;
                        gap: 24px;
                        margin-bottom: 24px;
                      "
                    >
                      <div>
                        <h4 style="margin-bottom: 12px">
                          <i class="fas fa-exclamation-triangle"></i> Failed
                          Requests
                        </h4>
                        <div
                          id="dashboardErrorsList"
                          class="errors-list"
                          style="max-height: 400px; overflow-y: auto"
                        >
                          <p class="no-data">
                            No errors found. Refresh Dashboard to load error
                            data.
                          </p>
                        </div>
                      </div>
                      <div>
                        <h4 style="margin-bottom: 12px">
                          <i class="fas fa-chart-bar"></i> Error Distribution
                        </h4>
                        <div style="min-height: 300px; position: relative">
                          <canvas id="dashboardErrorsChart"></canvas>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- End Errors Tab -->

                <!-- Analytics Tab -->
                <div class="dashboard-tab-content" data-tab-content="analytics">
                  <p class="hint" style="margin-bottom: 16px">
                    <i class="fas fa-info-circle"></i> Advanced analytics
                    including percentiles, anomalies, trends, and domain
                    comparisons.
                  </p>

                  <!-- Percentiles Analysis -->
                  <div class="analytics-section">
                    <h3>
                      <i class="fas fa-percentage"></i> Response Time
                      Percentiles
                    </h3>
                    <div
                      id="percentilesLoading"
                      class="loading-indicator"
                      style="display: none"
                    >
                      <i class="fas fa-spinner fa-spin"></i> Loading
                      percentiles...
                    </div>
                    <div class="percentiles-grid" id="percentilesGrid">
                      <div class="percentile-card">
                        <div class="percentile-label">P50 (Median)</div>
                        <div class="percentile-value" id="p50Value">-</div>
                        <div class="percentile-desc">50% of requests</div>
                      </div>
                      <div class="percentile-card">
                        <div class="percentile-label">P75</div>
                        <div class="percentile-value" id="p75Value">-</div>
                        <div class="percentile-desc">75% of requests</div>
                      </div>
                      <div class="percentile-card">
                        <div class="percentile-label">P90</div>
                        <div class="percentile-value" id="p90Value">-</div>
                        <div class="percentile-desc">90% of requests</div>
                      </div>
                      <div class="percentile-card">
                        <div class="percentile-label">P95</div>
                        <div class="percentile-value" id="p95Value">-</div>
                        <div class="percentile-desc">95% of requests</div>
                      </div>
                      <div class="percentile-card">
                        <div class="percentile-label">P99</div>
                        <div class="percentile-value" id="p99Value">-</div>
                        <div class="percentile-desc">99% of requests</div>
                      </div>
                      <div class="percentile-card">
                        <div class="percentile-label">Max</div>
                        <div class="percentile-value" id="maxValue">-</div>
                        <div class="percentile-desc">Slowest request</div>
                      </div>
                    </div>
                  </div>

                  <!-- Features removed: Anomaly Detection, Trend Analysis, Heatmap, Domain Comparison, Performance Insights -->
                  <!-- These don't provide actionable value for developers actively building/testing applications -->
                </div>
                <!-- End Analytics Tab -->
              </div>
              <!-- End Dashboard Tabs -->
            </div>
          </section>

          <!-- Alerts Tab -->
          <section id="alerts" class="tab-content">
            <div class="alerts-container">
              <h2><i class="fas fa-bell"></i> Alerts & Notifications</h2>

              <!-- Alert Rules -->
              <div class="alerts-section">
                <div class="section-header">
                  <h3><i class="fas fa-cog"></i> Alert Rules</h3>
                  <button id="addAlertRuleBtn" class="btn-primary">
                    <i class="fas fa-plus"></i> Add Rule
                  </button>
                </div>
                <div
                  id="alertRulesLoading"
                  class="loading-indicator"
                  style="display: none"
                >
                  <i class="fas fa-spinner fa-spin"></i> Loading alert rules...
                </div>
                <div id="alertRulesList" class="alert-rules-list">
                  <p class="placeholder">
                    No alert rules configured. Click "Add Rule" to create your
                    first alert.
                  </p>
                </div>
              </div>

              <!-- Alert History -->
              <div class="alerts-section">
                <div class="section-header">
                  <h3><i class="fas fa-history"></i> Alert History</h3>
                  <button id="refreshAlertHistoryBtn" class="btn-secondary">
                    <i class="fas fa-sync-alt"></i> Refresh
                  </button>
                </div>
                <div
                  id="alertHistoryLoading"
                  class="loading-indicator"
                  style="display: none"
                >
                  <i class="fas fa-spinner fa-spin"></i> Loading alert
                  history...
                </div>
                <div id="alertHistoryList" class="alert-history-list">
                  <p class="placeholder">No alerts have been triggered</p>
                </div>
              </div>

              <!-- Alert Configuration Modal -->
              <div id="alertRuleModal" class="modal" style="display: none">
                <div class="modal-content">
                  <div class="modal-header">
                    <h3><i class="fas fa-bell"></i> Configure Alert Rule</h3>
                    <button class="modal-close">&times;</button>
                  </div>
                  <div class="modal-body">
                    <div class="form-group">
                      <label for="alertName">Alert Name:</label>
                      <input
                        type="text"
                        id="alertName"
                        placeholder="e.g., High Response Time Alert"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label for="alertMetric">Metric:</label>
                      <select id="alertMetric">
                        <option value="avgDuration">
                          Average Response Time
                        </option>
                        <option value="errorRate">Error Rate (%)</option>
                        <option value="requestCount">Request Count</option>
                        <option value="maxDuration">Max Response Time</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="alertCondition">Condition:</label>
                      <select id="alertCondition">
                        <option value="gt">Greater Than</option>
                        <option value="lt">Less Than</option>
                        <option value="eq">Equal To</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label for="alertThreshold">Threshold:</label>
                      <input
                        type="number"
                        id="alertThreshold"
                        placeholder="e.g., 1000"
                        required
                      />
                    </div>
                    <div class="form-group">
                      <label for="alertDomain">Domain (Optional):</label>
                      <select id="alertDomain">
                        <option value="">All Domains</option>
                      </select>
                    </div>
                    <div class="form-group">
                      <label>
                        <input type="checkbox" id="alertEnabled" checked />
                        Enable this alert
                      </label>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button id="saveAlertRuleBtn" class="btn-primary">
                      <i class="fas fa-save"></i> Save Rule
                    </button>
                    <button id="cancelAlertRuleBtn" class="btn-secondary">
                      Cancel
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Runners Tab -->
          <section id="runners" class="tab-content">
            <div class="dashboard-container" style="max-width: 1400px">
              <!-- Runners Header with Sub-tabs -->
              <div class="dashboard-header">
                <h2><i class="fas fa-play-circle"></i> Request Runners</h2>
                <p style="margin: 8px 0 0 0; color: var(--text-secondary)">
                  Manage runners and organize them into collections
                </p>
              </div>

              <!-- Sub-navigation for Runners and Collections -->
              <div
                class="sub-tabs"
                style="
                  margin-bottom: 24px;
                  border-bottom: 2px solid var(--border-color);
                "
              >
                <button class="sub-tab-btn active" data-subtab="runners-list">
                  <i class="fas fa-play-circle"></i> Runners
                </button>
                <button class="sub-tab-btn" data-subtab="collections-list">
                  <i class="fas fa-folder"></i> Collections
                </button>
              </div>

              <!-- Runners List View -->
              <div id="runners-list" class="sub-tab-content active">
                <!-- Runners Controls -->
                <div class="dashboard-controls" style="margin-bottom: 24px">
                  <div style="display: flex; gap: 12px; flex: 1">
                    <input
                      type="text"
                      id="runnerSearch"
                      placeholder="Search runners..."
                      class="filter-select"
                      style="flex: 1; max-width: 400px"
                    />
                    <select
                      id="runnerTypeFilter"
                      class="filter-select"
                      style="width: 150px"
                    >
                      <option value="all">All Types</option>
                      <option value="saved">Saved Only</option>
                      <option value="temporary">Quick Runs Only</option>
                    </select>
                  </div>
                  <div style="display: flex; gap: 8px">
                    <button
                      id="btnRefreshRunners"
                      class="secondary-btn"
                      title="Refresh"
                    >
                      <i class="fas fa-sync-alt"></i>
                    </button>
                    <button id="btnCreateRunner" class="btn-primary">
                      <i class="fas fa-plus"></i> Create Runner
                    </button>
                  </div>
                </div>

                <!-- Runners Grid -->
                <div id="runnersGrid" class="runners-grid">
                  <!-- Runners will be loaded here -->
                  <div
                    style="
                      grid-column: 1 / -1;
                      text-align: center;
                      padding: 60px 20px;
                      color: var(--text-secondary);
                    "
                  >
                    <i
                      class="fas fa-spinner fa-pulse"
                      style="font-size: 48px; margin-bottom: 16px"
                    ></i>
                    <p>Loading runners...</p>
                  </div>
                </div>
              </div>

              <!-- Collections List View -->
              <div id="collections-list" class="sub-tab-content">
                <!-- Collections Controls -->
                <div class="dashboard-controls" style="margin-bottom: 24px">
                  <div style="flex: 1"></div>
                  <div style="display: flex; gap: 8px">
                    <button
                      id="btnRefreshCollections"
                      class="secondary-btn"
                      title="Refresh"
                    >
                      <i class="fas fa-sync-alt"></i>
                    </button>
                    <button id="btnCreateCollection" class="btn-primary">
                      <i class="fas fa-plus"></i> Create Collection
                    </button>
                  </div>
                </div>

                <!-- Collections Grid -->
                <div id="collectionsGrid" class="collections-grid">
                  <!-- Collections will be loaded here -->
                  <div
                    style="
                      grid-column: 1 / -1;
                      text-align: center;
                      padding: 60px 20px;
                      color: var(--text-secondary);
                    "
                  >
                    <i
                      class="fas fa-spinner fa-spin"
                      style="font-size: 32px"
                    ></i>
                    <p style="margin-top: 16px">Loading collections...</p>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- General Settings Tab -->
          <section id="general" class="tab-content">
            <div class="options-container">
              <!-- Capture Settings -->
              <div class="option-section">
                <h2><i class="fas fa-power-off"></i> Capture Settings</h2>
                <div class="option-row">
                  <div class="toggle-switch-row">
                    <label class="toggle-label">
                      <span class="toggle-text">Enable Request Capture</span>
                      <input
                        type="checkbox"
                        id="captureEnabled"
                        class="toggle-input"
                      />
                      <span class="toggle-slider"></span>
                    </label>
                    <span id="captureStatus" class="status-indicator"></span>
                  </div>
                </div>

                <div class="option-row">
                  <label for="maxStoredRequests" class="input-label">
                    <i class="fas fa-database"></i> Maximum Stored Requests
                  </label>
                  <div class="input-with-unit">
                    <input
                      type="number"
                      id="maxStoredRequests"
                      min="100"
                      max="100000"
                      step="100"
                      class="modern-input"
                    />
                    <span class="input-unit">requests</span>
                  </div>
                  <div class="storage-usage">
                    <span id="currentStorageCount">0</span> /
                    <span id="maxStorageDisplay">10,000</span> requests
                    <div class="usage-bar">
                      <div
                        id="usageBarFill"
                        class="usage-bar-fill"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                </div>

                <div class="option-row">
                  <label class="input-label">Quick Presets</label>
                  <div class="preset-buttons">
                    <button class="preset-btn" data-value="1000">
                      <i class="fas fa-feather"></i> Light (1K)
                    </button>
                    <button class="preset-btn" data-value="10000">
                      <i class="fas fa-balance-scale"></i> Medium (10K)
                    </button>
                    <button class="preset-btn" data-value="50000">
                      <i class="fas fa-weight-hanging"></i> Heavy (50K)
                    </button>
                    <button class="preset-btn" data-value="100000">
                      <i class="fas fa-rocket"></i> Max (100K)
                    </button>
                  </div>
                </div>
              </div>

              <!-- Capture Filters -->
              <div class="option-section">
                <h2><i class="fas fa-filter"></i> Capture Filters</h2>
                <p class="description">
                  Configure what requests to capture. Changes are automatically
                  applied to all visualizations.
                </p>

                <div class="option-row">
                  <div class="toggle-switch-row">
                    <label class="toggle-label">
                      <span class="toggle-text"
                        >Auto-apply filters to all visualizations</span
                      >
                      <input
                        type="checkbox"
                        id="autoApplyFilters"
                        checked
                        class="toggle-input"
                      />
                      <span class="toggle-slider"></span>
                    </label>
                    <span
                      class="status-indicator active"
                      id="filterApplyStatus"
                    ></span>
                  </div>
                </div>

                <h3><i class="fas fa-network-wired"></i> Request Types</h3>
                <div class="option-row">
                  <div class="checkbox-grid">
                    <label class="checkbox-card">
                      <input
                        type="checkbox"
                        name="captureType"
                        value="xmlhttprequest"
                      />
                      <span class="checkbox-card-content">
                        <i class="fas fa-code"></i>
                        <span>XHR</span>
                      </span>
                    </label>
                    <label class="checkbox-card">
                      <input type="checkbox" name="captureType" value="fetch" />
                      <span class="checkbox-card-content">
                        <i class="fas fa-download"></i>
                        <span>Fetch</span>
                      </span>
                    </label>
                    <label class="checkbox-card">
                      <input
                        type="checkbox"
                        name="captureType"
                        value="script"
                      />
                      <span class="checkbox-card-content">
                        <i class="fas fa-file-code"></i>
                        <span>Script</span>
                      </span>
                    </label>
                    <label class="checkbox-card">
                      <input
                        type="checkbox"
                        name="captureType"
                        value="stylesheet"
                      />
                      <span class="checkbox-card-content">
                        <i class="fas fa-palette"></i>
                        <span>Stylesheet</span>
                      </span>
                    </label>
                    <label class="checkbox-card">
                      <input type="checkbox" name="captureType" value="image" />
                      <span class="checkbox-card-content">
                        <i class="fas fa-image"></i>
                        <span>Image</span>
                      </span>
                    </label>
                    <label class="checkbox-card">
                      <input type="checkbox" name="captureType" value="font" />
                      <span class="checkbox-card-content">
                        <i class="fas fa-font"></i>
                        <span>Font</span>
                      </span>
                    </label>
                    <label class="checkbox-card">
                      <input type="checkbox" name="captureType" value="other" />
                      <span class="checkbox-card-content">
                        <i class="fas fa-ellipsis-h"></i>
                        <span>Other</span>
                      </span>
                    </label>
                  </div>
                </div>

                <h3><i class="fas fa-globe"></i> Domain Filters</h3>
                <div class="option-row">
                  <label for="includeDomains" class="input-label">
                    <i class="fas fa-check-circle"></i> Include Domains
                  </label>
                  <input
                    type="text"
                    id="includeDomains"
                    class="modern-input"
                    placeholder="github.com, api.github.com (comma separated)"
                  />
                  <span id="includeDomainsError" class="error-message"></span>
                  <p class="help-text">
                    <i class="fas fa-info-circle"></i> Wildcard support:
                    *.example.com matches all subdomains. Leave empty to capture
                    all domains.
                  </p>
                </div>

                <div class="option-row">
                  <label for="excludeDomains" class="input-label">
                    <i class="fas fa-times-circle"></i> Exclude Domains
                  </label>
                  <input
                    type="text"
                    id="excludeDomains"
                    class="modern-input"
                    placeholder="Browser pages excluded by default"
                  />
                  <span id="excludeDomainsError" class="error-message"></span>
                  <p class="help-text">
                    <i class="fas fa-info-circle"></i> Browser internal pages
                    (chrome://, edge://, about:) are automatically excluded.
                  </p>
                </div>

                <h3><i class="fas fa-cogs"></i> Advanced Filters</h3>
                <div class="option-row">
                  <label for="urlPattern" class="input-label">
                    <i class="fas fa-search"></i> URL Pattern (Regex)
                  </label>
                  <input
                    type="text"
                    id="urlPattern"
                    class="modern-input"
                    placeholder="/api/.*|/graphql.*"
                  />
                  <span id="urlPatternError" class="error-message"></span>
                  <p class="help-text">
                    <i class="fas fa-info-circle"></i> JavaScript regex pattern
                    to match request URLs
                  </p>
                </div>
              </div>

              <!-- Visualization Settings -->
              <div class="option-section">
                <h2><i class="fas fa-chart-bar"></i> Visualization</h2>
                <div class="option-row">
                  <div class="toggle-switch-row">
                    <label class="toggle-label">
                      <span class="toggle-text">Enable Plots</span>
                      <input
                        type="checkbox"
                        id="plotEnabled"
                        class="toggle-input"
                      />
                      <span class="toggle-slider"></span>
                    </label>
                  </div>
                </div>

                <div class="option-row">
                  <label class="input-label">Plot Types</label>
                  <div class="checkbox-grid">
                    <label class="checkbox-card">
                      <input
                        type="checkbox"
                        name="plotType"
                        value="responseTime"
                      />
                      <span class="checkbox-card-content">
                        <i class="fas fa-clock"></i>
                        <span>Response Time</span>
                      </span>
                    </label>
                    <label class="checkbox-card">
                      <input
                        type="checkbox"
                        name="plotType"
                        value="statusCodes"
                      />
                      <span class="checkbox-card-content">
                        <i class="fas fa-info-circle"></i>
                        <span>Status Codes</span>
                      </span>
                    </label>
                    <label class="checkbox-card">
                      <input type="checkbox" name="plotType" value="domains" />
                      <span class="checkbox-card-content">
                        <i class="fas fa-server"></i>
                        <span>Domains</span>
                      </span>
                    </label>
                    <label class="checkbox-card">
                      <input
                        type="checkbox"
                        name="plotType"
                        value="requestTypes"
                      />
                      <span class="checkbox-card-content">
                        <i class="fas fa-list"></i>
                        <span>Request Types</span>
                      </span>
                    </label>
                    <label class="checkbox-card">
                      <input
                        type="checkbox"
                        name="plotType"
                        value="timeDistribution"
                      />
                      <span class="checkbox-card-content">
                        <i class="fas fa-chart-area"></i>
                        <span>Time Distribution</span>
                      </span>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Site Tracking Configuration -->
              <div class="option-section">
                <h2>
                  <i class="fas fa-globe-americas"></i> Site Tracking
                  Configuration
                </h2>
                <p class="description">
                  Configure specific sites to track for analysis. Content
                  scripts will filter data based on these sites.
                </p>

                <div class="option-row">
                  <label for="trackingSites" class="input-label">
                    <i class="fas fa-list"></i> Sites to Track
                  </label>
                  <textarea
                    id="trackingSites"
                    rows="6"
                    class="modern-textarea"
                    placeholder="Enter one site pattern per line, e.g.:
https://example.com
https://*.github.com
/api\.example\.com/ (regex)
*.mysite.com
example.org/api/*"
                  ></textarea>
                  <p class="help-text">
                    <i class="fas fa-info-circle"></i>
                    <strong>Supported formats:</strong><br />
                     Full URLs: https://example.com<br />
                     Wildcards: *.example.com or example.com/*<br />
                     Regex patterns: /pattern/ (between slashes)<br />
                     Mixed: https://*.api.example.com/v1/*
                  </p>
                </div>

                <div class="option-row">
                  <button id="validateSitesBtn" class="secondary-btn">
                    <i class="fas fa-check-circle"></i> Validate Patterns
                  </button>
                  <button id="addCurrentSiteBtn" class="secondary-btn">
                    <i class="fas fa-plus"></i> Add Current Site
                  </button>
                  <span id="sitesValidationResult" class="help-text"></span>
                </div>

                <div class="option-row">
                  <div class="toggle-switch-row">
                    <label class="toggle-label">
                      <span class="toggle-text"
                        >Track ONLY configured sites (if unchecked, tracks all
                        sites)</span
                      >
                      <input
                        type="checkbox"
                        id="trackOnlyConfiguredSites"
                        checked
                        class="toggle-input"
                      />
                      <span class="toggle-slider"></span>
                    </label>
                  </div>
                </div>

                <div class="tracked-sites-box">
                  <h4>
                    <i class="fas fa-info-circle"></i> Currently Tracked Sites
                  </h4>
                  <div id="trackedSitesList">
                    <p class="placeholder">
                      No sites configured. Add sites above to start tracking
                      specific URLs.
                    </p>
                  </div>
                </div>

                <div class="option-row">
                  <label class="input-label">Quick Site Presets</label>
                  <div class="preset-buttons">
                    <button class="site-preset-btn" data-preset="current">
                      <i class="fas fa-window-maximize"></i> Add Current Tab
                    </button>
                    <button class="site-preset-btn" data-preset="popular">
                      <i class="fas fa-fire"></i> Popular APIs
                    </button>
                    <button class="site-preset-btn" data-preset="clear">
                      <i class="fas fa-trash"></i> Clear All
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Export Settings Tab -->
          <section id="export" class="tab-content">
            <div class="options-container">
              <div class="option-section">
                <h2>Manual Export</h2>
                <div class="option-row">
                  <button id="exportNowBtn" class="btn-primary">
                    <i class="fas fa-download"></i> Export Now
                  </button>
                  <select id="manualExportFormat">
                    <option value="json">JSON</option>
                    <option value="csv">CSV</option>
                    <option value="sqlite">SQLite</option>
                  </select>
                  <p class="description">
                    Immediately export all collected data
                  </p>
                </div>
                <div class="option-row">
                  <label>Last Export:</label>
                  <span id="lastExportTime">Never</span>
                </div>
              </div>

              <div class="option-section">
                <h2>Auto Export</h2>
                <div class="option-row">
                  <label>
                    <input type="checkbox" id="autoExport" />
                    Enable Auto Export
                  </label>
                  <span id="autoExportStatus" class="status-indicator"></span>
                </div>
                <div class="option-row">
                  <label for="exportFormat">Export Format:</label>
                  <select id="exportFormat">
                    <option value="json">JSON</option>
                    <option value="csv">CSV</option>
                    <option value="sqlite">SQLite</option>
                  </select>
                </div>
                <div class="option-row">
                  <label for="exportInterval">Export Interval (minutes):</label>
                  <input
                    type="number"
                    id="exportInterval"
                    min="5"
                    max="1440"
                    step="5"
                  />
                  <span class="help-text"
                    >Next export in: <span id="nextExportTime">--</span></span
                  >
                </div>
                <div class="option-row">
                  <label for="exportPath">Export Directory (optional):</label>
                  <input
                    type="text"
                    id="exportPath"
                    placeholder="Default downloads directory"
                  />
                </div>
              </div>
            </div>
          </section>

          <!-- Data Retention Tab -->
          <section id="retention" class="tab-content">
            <div class="options-container">
              <!-- Settings Profiles Section -->
              <div class="option-section">
                <h2><i class="fas fa-layer-group"></i> Settings Profiles</h2>
                <p class="section-description">
                  Save and load preset configurations for different environments
                  (Development, Production, Testing, etc.)
                </p>

                <div class="profiles-container">
                  <div class="profile-actions">
                    <button id="saveProfile" class="btn-primary">
                      <i class="fas fa-save"></i> Save Current as Profile
                    </button>
                    <button id="manageProfiles" class="btn-secondary">
                      <i class="fas fa-cog"></i> Manage Profiles
                    </button>
                  </div>

                  <div class="profiles-grid">
                    <h4>Quick Load Profiles</h4>
                    <div id="profilesList" class="profiles-list">
                      <!-- Populated dynamically -->
                      <div class="empty-state">
                        <i class="fas fa-layer-group fa-3x"></i>
                        <p>No profiles saved yet</p>
                        <p class="help-text">
                          Click "Save Current as Profile" to create your first
                          profile
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="option-section">
                <h2>Data Management & Operations</h2>

                <div class="info-box">
                  <h4>
                    <i class="fas fa-database"></i> Current Database Status
                  </h4>
                  <div class="db-status-grid">
                    <div class="db-stat">
                      <span class="label">Total Size:</span>
                      <span id="currentDbSize" class="value"
                        >Calculating...</span
                      >
                    </div>
                    <div class="db-stat">
                      <span class="label">Total Records:</span>
                      <span id="currentDbRecords" class="value">0</span>
                    </div>
                    <div class="db-stat">
                      <span class="label">Oldest Record:</span>
                      <span id="oldestRecord" class="value">N/A</span>
                    </div>
                  </div>
                </div>

                <h3><i class="fas fa-clock"></i> Cleanup Preview</h3>
                <div class="option-row">
                  <label for="cleanupAge"
                    >Delete records older than (days):</label
                  >
                  <input
                    type="number"
                    id="cleanupAge"
                    min="1"
                    max="365"
                    value="30"
                  />
                </div>

                <div class="option-row">
                  <button id="previewCleanupBtn" class="secondary-btn">
                    <i class="fas fa-eye"></i> Preview Cleanup
                  </button>
                  <div
                    id="cleanupPreview"
                    class="preview-box"
                    style="display: none"
                  >
                    <h4>Cleanup Preview:</h4>
                    <p>
                      Records to delete:
                      <strong id="previewRecordsCount">0</strong>
                    </p>
                    <p>
                      Estimated size freed:
                      <strong id="previewSizeFreed">0 MB</strong>
                    </p>
                    <p>
                      Records remaining:
                      <strong id="previewRecordsRemaining">0</strong>
                    </p>
                  </div>
                </div>

                <div class="option-row">
                  <button id="createBackupBtn" class="btn-primary">
                    <i class="fas fa-save"></i> Create Manual Backup
                  </button>
                  <span id="lastBackupTime" class="help-text"
                    >Last backup: Never</span
                  >
                </div>

                <h3><i class="fas fa-exchange-alt"></i> Database Operations</h3>
                <p class="description" style="margin-bottom: 16px">
                  Export, import, and manage your database.
                  <strong>Import replaces your entire database</strong> - a
                  backup is created automatically.
                </p>

                <div class="operations-grid">
                  <!-- Export Database Card -->
                  <div class="operation-card">
                    <h4><i class="fas fa-download"></i> Export Database</h4>
                    <p>
                      Download your entire database as a SQLite file. Use this
                      for backups or transferring data.
                    </p>
                    <button id="exportRawDbBtn" class="btn-primary">
                      <i class="fas fa-download"></i> Export SQLite Database
                    </button>
                  </div>

                  <!-- Import Database Card -->
                  <div class="operation-card warning">
                    <h4><i class="fas fa-upload"></i> Import Database</h4>
                    <p>
                      <strong> Replaces current database completely.</strong
                      ><br />
                      Automatic backup created first. Choose a .sqlite or .db
                      file.
                    </p>
                    <input
                      type="file"
                      id="importDbFile"
                      accept=".sqlite,.db"
                      style="display: none"
                    />
                    <button id="importDbBtn" class="warning-btn">
                      <i class="fas fa-upload"></i> Import SQLite Database
                    </button>
                  </div>

                  <!-- Vacuum Database Card -->
                  <div class="operation-card">
                    <h4><i class="fas fa-compress-alt"></i> Vacuum Database</h4>
                    <p>
                      Compact database to reclaim disk space. Recommended after
                      cleanup or deletions.
                    </p>
                    <button id="vacuumDatabaseBtn" class="secondary-btn">
                      <i class="fas fa-compress-alt"></i> Vacuum Database
                    </button>
                  </div>

                  <!-- Clear Cache Card -->
                  <div class="operation-card">
                    <h4><i class="fas fa-eraser"></i> Clear Cache</h4>
                    <p>
                      Clear extension cache and force reload. Less destructive
                      than reset.
                    </p>
                    <button id="clearCacheBtn" class="secondary-btn">
                      <i class="fas fa-eraser"></i> Clear Extension Cache
                    </button>
                  </div>
                </div>

                <div class="danger-zone">
                  <h3>
                    <i class="fas fa-exclamation-triangle"></i> Danger Zone
                  </h3>
                  <p class="warning-text">
                    <strong> Warning:</strong> These operations permanently
                    delete data. Always create a backup before proceeding!
                  </p>

                  <div class="operations-grid">
                    <!-- Execute Cleanup Card -->
                    <div class="operation-card danger">
                      <h4><i class="fas fa-broom"></i> Delete Old Records</h4>
                      <p>
                        <strong>Removes records older than X days</strong> (you
                        choose: 30, 60, 90 days).<br />
                        Recent data is kept. Must preview first to see what will
                        be deleted.
                      </p>
                      <button
                        id="executeCleanupBtn"
                        class="danger-btn"
                        disabled
                      >
                        <i class="fas fa-broom"></i> Execute Cleanup
                      </button>
                    </div>

                    <!-- Reset Database Card -->
                    <div class="operation-card danger">
                      <h4><i class="fas fa-trash-alt"></i> Complete Reset</h4>
                      <p>
                        <strong>Deletes EVERYTHING</strong> - all requests, all
                        analytics, all history.<br />
                        Like a fresh install. Cannot be undone! Double
                        confirmation required.
                      </p>
                      <button id="resetDatabaseBtn" class="danger-btn">
                        <i class="fas fa-trash-alt"></i> Reset Database
                      </button>
                    </div>
                  </div>
                </div>

                <h3><i class="fas fa-history"></i> Cleanup History</h3>
                <div id="cleanupHistory" class="history-box">
                  <p class="placeholder">No cleanup history available</p>
                </div>
              </div>
            </div>
          </section>

          <!-- Security Settings Tab -->
          <section id="security" class="tab-content">
            <div class="options-container">
              <div class="option-section">
                <h2>Settings Import/Export</h2>

                <div class="warning-box">
                  <i class="fas fa-exclamation-triangle"></i>
                  <strong>Warning:</strong> Importing will overwrite your
                  current settings. A backup will be created automatically.
                </div>

                <h3><i class="fas fa-file-export"></i> Export Settings</h3>
                <div class="option-row">
                  <button id="exportSettingsBtn" class="btn-primary">
                    <i class="fas fa-download"></i> Export Settings
                  </button>
                  <p class="description">
                    Export all settings to a JSON file for backup or transfer
                  </p>
                </div>

                <div class="option-row">
                  <label>
                    <input type="checkbox" id="encryptExport" />
                    <span>Encrypt with password (coming soon)</span>
                  </label>
                </div>

                <h3><i class="fas fa-file-import"></i> Import Settings</h3>
                <div class="option-row">
                  <input
                    type="file"
                    id="importSettingsFile"
                    accept=".json"
                    style="display: none"
                  />
                  <button id="importSettingsBtn" class="btn-primary">
                    <i class="fas fa-upload"></i> Import Settings
                  </button>
                  <p class="description">
                    Import settings from a previously exported file
                  </p>
                </div>

                <div class="option-row">
                  <label>
                    <input type="checkbox" id="selectiveImport" />
                    <span>Selective Import (choose specific sections)</span>
                  </label>
                </div>

                <div
                  id="selectiveImportOptions"
                  class="selective-import-box import-section-selector"
                  style="display: none"
                >
                  <h4>Select sections to import:</h4>
                  <div class="import-sections-grid">
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        name="importSection"
                        value="general"
                        checked
                      />
                      General Settings
                    </label>
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        name="importSection"
                        value="filters"
                        checked
                      />
                      Filters
                    </label>
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        name="importSection"
                        value="monitoring"
                        checked
                      />
                      Monitoring
                    </label>
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        name="importSection"
                        value="export"
                        checked
                      />
                      Export Settings
                    </label>
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        name="importSection"
                        value="themes"
                        checked
                      />
                      Themes
                    </label>
                    <label class="checkbox-label">
                      <input
                        type="checkbox"
                        name="importSection"
                        value="retention"
                        checked
                      />
                      Data Retention
                    </label>
                  </div>
                </div>

                <h3>
                  <i class="fas fa-info-circle"></i> Import Safety Features
                </h3>
                <ul class="safety-features-list">
                  <li> Automatic backup created before import</li>
                  <li> Settings validation before applying</li>
                  <li> Selective import to preserve specific settings</li>
                  <li> Version compatibility check (coming soon)</li>
                  <li> Password encryption support (coming soon)</li>
                </ul>
              </div>
            </div>
          </section>

          <!-- Themes Settings Tab -->
          <section id="themes" class="tab-content">
            <div class="options-container">
              <div class="option-section">
                <h2>Theme Settings</h2>
                <div class="option-row">
                  <label for="currentTheme">Current Theme:</label>
                  <select id="currentTheme">
                    <option value="system">System Preference</option>
                    <option value="light">Light</option>
                    <option value="dark">Dark</option>
                    <option value="highContrast">High Contrast</option>
                    <option value="blue">Blue</option>
                  </select>
                </div>

                <h3>Available Themes</h3>
                <div class="themes-container">
                  <!-- Theme cards will be added dynamically -->
                </div>

                <div class="option-row actions">
                  <button id="saveThemeBtn" class="primary-btn">
                    Save Changes
                  </button>
                  <button id="resetThemeBtn" class="secondary-btn">
                    Reset to Default
                  </button>
                </div>
              </div>
            </div>
          </section>

          <!-- Variables Tab -->
          <section id="variables" class="tab-content">
            <div class="options-container">
              <div class="option-section">
                <h2><i class="fas fa-variable"></i> Variables Management</h2>
                <p class="description">
                  Define reusable variables for curl/fetch commands. Use
                  ${VAR_NAME} syntax in your exported requests to reference
                  sensitive values like API tokens.
                </p>

                <div class="variables-controls">
                  <button id="addVariableBtn" class="btn-primary">
                    <i class="fas fa-plus"></i> Add Variable
                  </button>
                  <div class="toggle-group">
                    <label for="variablesEnabled">
                      <input type="checkbox" id="variablesEnabled" checked />
                      Enable Variables
                    </label>
                    <label for="variablesAutoDetect">
                      <input type="checkbox" id="variablesAutoDetect" checked />
                      Auto-detect values
                    </label>
                  </div>
                </div>

                <div id="variablesListContainer" class="variables-list">
                  <div class="empty-state">
                    <i class="fas fa-variable"></i>
                    <p>No variables defined yet</p>
                    <p class="description">
                      Click "Add Variable" to create your first variable
                    </p>
                  </div>
                </div>

                <div class="variables-help">
                  <h3><i class="fas fa-info-circle"></i> Usage Examples</h3>
                  <div class="code-examples">
                    <div class="example">
                      <h4>Define a variable:</h4>
                      <pre>
Name: API_TOKEN
Value: your-secret-token-here
Description: Production API authentication token</pre
                      >
                    </div>
                    <div class="example">
                      <h4>Use in curl:</h4>
                      <pre>
curl 'https://api.example.com/data' \
  -H 'Authorization: Bearer ${API_TOKEN}' \
  --compressed</pre
                      >
                    </div>
                    <div class="example">
                      <h4>Use in fetch:</h4>
                      <pre>
fetch('https://api.example.com/data', {
  "method": "GET",
  "headers": {
    "Authorization": "Bearer ${API_TOKEN}"
  }
})</pre
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Advanced Tab -->
          <section id="advanced" class="tab-content">
            <div class="options-container">
              <div class="option-section">
                <h2>Advanced Features</h2>
                <p class="description">
                  Advanced debugging and database management tools
                </p>

                <h3><i class="fas fa-database"></i> Database Management</h3>

                <div class="option-row">
                  <label>Database Location:</label>
                  <code>IndexedDB: ura_medallion_db</code>
                </div>

                <div class="option-row">
                  <label>Database Size:</label>
                  <span id="advancedDbSize">Calculating...</span>
                </div>

                <div class="option-row">
                  <label>Total Records:</label>
                  <div class="db-layer-stats">
                    <div class="stat-item">
                      <span class="stat-label">Bronze:</span>
                      <span id="advancedBronzeCount">0</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-label">Silver:</span>
                      <span id="advancedSilverCount">0</span>
                    </div>
                    <div class="stat-item">
                      <span class="stat-label">Gold:</span>
                      <span id="advancedGoldCount">0</span>
                    </div>
                  </div>
                </div>

                <h3><i class="fas fa-table"></i> Database Tables</h3>
                <div class="tables-section">
                  <div class="option-row">
                    <label>Available Tables:</label>
                    <div id="tablesListContainer" class="tables-list">
                      <p class="placeholder">Loading tables...</p>
                    </div>
                  </div>
                  <div class="option-row">
                    <label>Table Preview (5 records):</label>
                    <div id="tablePreviewContainer" class="table-preview">
                      <p class="placeholder">
                        Select a table above to preview records
                      </p>
                    </div>
                  </div>
                </div>

                <h3><i class="fas fa-search"></i> Direct Database Query</h3>
                <div class="query-section">
                  <div class="option-row">
                    <label for="advancedQuery">SQL Query:</label>
                    <textarea
                      id="advancedQuery"
                      rows="5"
                      placeholder="SELECT * FROM bronze_requests LIMIT 10"
                    ></textarea>
                  </div>
                  <!-- IMPROVEMENT 3: Query Templates -->
                  <div class="option-row">
                    <label for="queryTemplateSelect">Quick Templates:</label>
                    <select id="queryTemplateSelect" class="form-control">
                      <option value="">-- Select a template --</option>
                      <option value="Select All from Table">
                         Select All from Table
                      </option>
                      <option value="Count Records"> Count Records</option>
                      <option value="Recent Records (24h)">
                         Recent Records (24h)
                      </option>
                      <option value="Group By Domain">
                         Group By Domain
                      </option>
                      <option value="Top Status Codes">
                         Top Status Codes
                      </option>
                      <option value="Slow Requests (>1s)">
                         Slow Requests (>1s)
                      </option>
                      <option value="Failed Requests (4xx/5xx)">
                         Failed Requests (4xx/5xx)
                      </option>
                      <option value="Request Methods Distribution">
                         Request Methods Distribution
                      </option>
                      <option value="Schema Inspection">
                         Schema Inspection
                      </option>
                      <option value="Database Stats"> Database Stats</option>
                    </select>
                  </div>
                  <div class="option-row">
                    <button id="executeQueryBtn" class="primary-btn">
                      <i class="fas fa-play"></i> Execute Query
                    </button>
                    <button id="clearQueryBtn" class="secondary-btn">
                      <i class="fas fa-eraser"></i> Clear
                    </button>
                  </div>
                  <div class="option-row">
                    <label>Query Result:</label>
                    <div id="queryResult" class="query-result">
                      <p class="placeholder">
                        Execute a query to see results...
                      </p>
                    </div>
                  </div>
                </div>

                <h3><i class="fas fa-history"></i> Query History</h3>
                <div class="query-history-section">
                  <div class="option-row">
                    <div id="queryHistoryContainer" class="query-history">
                      <p class="placeholder">
                        No query history yet. Execute queries to see them here.
                      </p>
                    </div>
                  </div>
                  <div class="option-row">
                    <button id="clearHistoryBtn" class="secondary-btn">
                      <i class="fas fa-trash"></i> Clear History
                    </button>
                  </div>
                </div>

                <h3><i class="fas fa-tools"></i> Debug Tools</h3>
                <div class="debug-actions">
                  <div class="option-row">
                    <button id="inspectSchemaBtn" class="secondary-btn">
                      <i class="fas fa-table"></i> Inspect Database Schema
                    </button>
                    <p class="description">
                      View all tables and their structures
                    </p>
                  </div>
                  <div class="option-row">
                    <button id="viewLogsBtn" class="secondary-btn">
                      <i class="fas fa-file-alt"></i> View Extension Logs
                    </button>
                    <p class="description">Open browser console to view logs</p>
                  </div>
                  <div class="option-row">
                    <button id="testConnectionBtn" class="secondary-btn">
                      <i class="fas fa-plug"></i> Test Background Connection
                    </button>
                    <p class="description">
                      Verify connection to background script
                    </p>
                  </div>
                  <div class="option-row">
                    <button id="forceProcessBtn" class="warning-btn">
                      <i class="fas fa-sync"></i> Force Data Processing
                    </button>
                    <p class="description">
                      Manually trigger BronzeSilverGold processing
                    </p>
                  </div>
                </div>

                <div class="info-box" style="margin-top: 20px">
                  <h4>
                    <i class="fas fa-info-circle"></i> Database Import/Export
                  </h4>
                  <p
                    style="
                      margin: 0;
                      font-size: 14px;
                      color: var(--text-secondary);
                    "
                  >
                    Database import and export features have been moved to the
                    <strong>Data Management</strong> tab for better organization
                    and safety.
                  </p>
                </div>
              </div>
            </div>
          </section>
        </main>
      </div>
    </div>

    <div id="notification" class="notification"></div>

    <!-- Settings Import Preview Modal -->
    <div id="importPreviewModal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 900px">
        <div class="modal-header">
          <h3><i class="fas fa-search"></i> Import Preview</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <!-- Validation Status -->
          <div id="importValidationStatus" class="validation-status">
            <div class="validation-item">
              <i class="fas fa-spinner fa-spin"></i>
              <span>Validating settings...</span>
            </div>
          </div>

          <!-- Summary Stats -->
          <div id="importSummary" class="import-summary" style="display: none">
            <div class="summary-stats">
              <div class="stat-card">
                <div class="stat-label">Sections</div>
                <div class="stat-value" id="previewSectionsCount">0</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Changes</div>
                <div class="stat-value" id="previewChangesCount">0</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Validation</div>
                <div class="stat-value" id="previewValidation">
                  <i class="fas fa-check-circle text-success"></i> Valid
                </div>
              </div>
            </div>
          </div>

          <!-- Errors Display -->
          <div id="importErrors" class="import-errors" style="display: none">
            <h4>
              <i class="fas fa-exclamation-triangle"></i> Validation Errors
            </h4>
            <ul id="importErrorsList"></ul>
          </div>

          <!-- Warnings Display -->
          <div
            id="importWarnings"
            class="import-warnings"
            style="display: none"
          >
            <h4><i class="fas fa-exclamation-circle"></i> Warnings</h4>
            <ul id="importWarningsList"></ul>
          </div>

          <!-- Changes Preview -->
          <div id="importChanges" class="import-changes" style="display: none">
            <h4><i class="fas fa-exchange-alt"></i> Changes Preview</h4>
            <div class="changes-table-container">
              <table class="changes-table">
                <thead>
                  <tr>
                    <th>Section</th>
                    <th>Setting</th>
                    <th>Current Value</th>
                    <th>New Value</th>
                  </tr>
                </thead>
                <tbody id="importChangesBody">
                  <!-- Populated dynamically -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- No Changes Message -->
          <div id="importNoChanges" class="info-message" style="display: none">
            <i class="fas fa-info-circle"></i>
            <p>
              No changes detected. The imported settings are identical to your
              current configuration.
            </p>
          </div>
        </div>
        <div class="modal-footer">
          <button id="applyImportBtn" class="btn-primary" disabled>
            <i class="fas fa-check"></i> Apply Changes
          </button>
          <button id="cancelImportBtn" class="btn-secondary">
            <i class="fas fa-times"></i> Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Profile Save Modal -->
    <div id="saveProfileModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-save"></i> Save Settings Profile</h3>
          <span class="close">&times;</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="profileName">
              <i class="fas fa-tag"></i> Profile Name:
            </label>
            <input
              type="text"
              id="profileName"
              placeholder="e.g., Development, Production, Testing"
              required
            />
          </div>
          <div class="form-group">
            <label for="profileDescription">
              <i class="fas fa-comment"></i> Description (optional):
            </label>
            <textarea
              id="profileDescription"
              rows="3"
              placeholder="Describe when to use this profile..."
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button id="confirmSaveProfile" class="btn-primary">
            <i class="fas fa-save"></i> Save Profile
          </button>
          <button id="cancelSaveProfile" class="btn-secondary">
            <i class="fas fa-times"></i> Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Profile Management Modal -->
    <div id="manageProfilesModal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 800px">
        <div class="modal-header">
          <h3><i class="fas fa-cog"></i> Manage Profiles</h3>
          <span class="close">&times;</span>
        </div>
        <div class="modal-body">
          <div id="manageProfilesList" class="manage-profiles-list">
            <!-- Populated dynamically -->
          </div>
        </div>
        <div class="modal-footer">
          <button id="closeManageProfiles" class="btn-secondary">
            <i class="fas fa-times"></i> Close
          </button>
        </div>
      </div>
    </div>

    <!-- Export Preview Modal -->
    <div id="exportPreviewModal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 900px">
        <div class="modal-header">
          <h3><i class="fas fa-download"></i> Export Preview</h3>
          <span class="close">&times;</span>
        </div>
        <div class="modal-body">
          <!-- Summary Stats -->
          <div class="export-summary">
            <div class="summary-stats">
              <div class="stat-card">
                <div class="stat-label">Sections</div>
                <div class="stat-value" id="exportSectionsCount">0</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">Settings</div>
                <div class="stat-value" id="exportSettingsCount">0</div>
              </div>
              <div class="stat-card">
                <div class="stat-label">File Size</div>
                <div class="stat-value" id="exportFileSize">0 KB</div>
              </div>
            </div>
          </div>

          <!-- Sections List -->
          <div class="export-sections">
            <h4><i class="fas fa-list"></i> Sections to Export</h4>
            <div id="exportSectionsList" class="sections-list">
              <!-- Populated dynamically -->
            </div>
          </div>

          <!-- Preview Content -->
          <div class="export-preview">
            <h4><i class="fas fa-code"></i> Preview (first 50 lines)</h4>
            <pre id="exportPreviewContent" class="preview-content"></pre>
          </div>
        </div>
        <div class="modal-footer">
          <button id="confirmExport" class="btn-primary">
            <i class="fas fa-download"></i> Download
          </button>
          <button id="cancelExport" class="btn-secondary">
            <i class="fas fa-times"></i> Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Dashboard Filter Modal -->
    <div id="dashboardFilterModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-filter"></i> Dashboard Filters</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="dashboardModalDomainFilter">
              <i class="fas fa-globe"></i> Domain:
            </label>
            <select id="dashboardModalDomainFilter" style="width: 100%">
              <option value="all">All Domains</option>
            </select>
          </div>
          <div class="form-group">
            <label for="dashboardModalPageFilter">
              <i class="fas fa-file"></i> Page:
            </label>
            <select id="dashboardModalPageFilter" style="width: 100%">
              <option value="">All Pages (Aggregated)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="dashboardModalRequestTypeFilter">
              <i class="fas fa-filter"></i> Type:
            </label>
            <select id="dashboardModalRequestTypeFilter" style="width: 100%">
              <option value="">All Types</option>
              <option value="xmlhttprequest">XHR/API</option>
              <option value="fetch">Fetch</option>
              <option value="script">Scripts</option>
              <option value="stylesheet">Stylesheets</option>
              <option value="image">Images</option>
              <option value="font">Fonts</option>
              <option value="document">Documents</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button id="applyDashboardFiltersBtn" class="btn-primary">
            <i class="fas fa-check"></i> Apply Filters
          </button>
          <button id="cancelDashboardFiltersBtn" class="btn-secondary">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Analytics Filter Modal -->
    <div id="analyticsFilterModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-filter"></i> Analytics Filters</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="analyticsModalDomainFilter">
              <i class="fas fa-globe"></i> Domain:
            </label>
            <select id="analyticsModalDomainFilter" style="width: 100%">
              <option value="all">All Domains</option>
            </select>
          </div>
          <div class="form-group">
            <label for="analyticsModalPageFilter">
              <i class="fas fa-file"></i> Page:
            </label>
            <select id="analyticsModalPageFilter" style="width: 100%">
              <option value="">All Pages (Aggregated)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="analyticsModalRequestTypeFilter">
              <i class="fas fa-filter"></i> Type:
            </label>
            <select id="analyticsModalRequestTypeFilter" style="width: 100%">
              <option value="">All Types</option>
              <option value="xmlhttprequest">XHR/API</option>
              <option value="fetch">Fetch</option>
              <option value="script">Scripts</option>
              <option value="stylesheet">Stylesheets</option>
              <option value="image">Images</option>
              <option value="font">Fonts</option>
              <option value="document">Documents</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button id="applyAnalyticsFiltersBtn" class="btn-primary">
            <i class="fas fa-check"></i> Apply Filters
          </button>
          <button id="cancelAnalyticsFiltersBtn" class="btn-secondary">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Request Details Modal -->
    <div id="requestDetailsModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-info-circle"></i> Request Details</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body" id="requestDetailsBody">
          <!-- Content populated by JavaScript -->
        </div>
        <div class="modal-footer">
          <button id="closeRequestDetailsBtn" class="btn-secondary">
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- cURL Command Modal -->
    <div id="curlCommandModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-terminal"></i> cURL Command</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 12px;
            "
          >
            <p style="margin: 0; color: var(--text-secondary)">
              Copy and paste this command in your terminal to reproduce the
              request:
            </p>
            <div style="display: flex; gap: 12px; align-items: center">
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 6px;
                  font-size: 13px;
                  cursor: pointer;
                "
              >
                <input type="checkbox" id="curlUseVariables" checked />
                <span>Use Variables</span>
              </label>
              <button
                id="editCurlBtn"
                class="btn-secondary"
                style="padding: 6px 12px; font-size: 13px"
              >
                <i class="fas fa-edit"></i> Edit
              </button>
            </div>
          </div>
          <div style="position: relative">
            <textarea
              id="curlCommandText"
              readonly
              style="
                background: var(--bg-secondary);
                padding: 16px;
                padding-top: 40px;
                border-radius: 4px;
                overflow-x: auto;
                margin: 0;
                font-family: 'Courier New', monospace;
                font-size: 13px;
                line-height: 1.5;
                border: 1px solid var(--border-color);
                width: 100%;
                min-height: 200px;
                resize: vertical;
                color: var(--text-primary-color);
              "
            ></textarea>
            <div
              id="curlVariablesDropdown"
              style="position: absolute; top: 8px; left: 8px; display: none"
            >
              <select
                id="curlVariableSelect"
                style="
                  padding: 4px 8px;
                  font-size: 12px;
                  border-radius: 4px;
                  border: 1px solid var(--border-color);
                  background: var(--surface-color);
                  color: var(--text-primary-color);
                  cursor: pointer;
                "
              >
                <option value="">Insert Variable...</option>
              </select>
            </div>
            <button
              id="copyCurlBtn"
              class="btn-icon"
              style="
                position: absolute;
                top: 8px;
                right: 8px;
                background: var(--primary-color);
                color: white;
                padding: 8px 12px;
                border-radius: 4px;
              "
            >
              <i class="fas fa-copy"></i> Copy
            </button>
            <button
              id="saveCurlBtn"
              class="btn-icon"
              style="
                position: absolute;
                top: 8px;
                right: 80px;
                background: var(--success-color);
                color: white;
                padding: 8px 12px;
                border-radius: 4px;
                display: none;
              "
            >
              <i class="fas fa-save"></i> Save
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Fetch Command Modal -->
    <div id="fetchCommandModal" class="modal" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-code"></i> Fetch API Code</h3>
          <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 12px;
            "
          >
            <p style="margin: 0; color: var(--text-secondary)">
              Copy and paste this code in your browser console or JavaScript to
              reproduce the request:
            </p>
            <div style="display: flex; gap: 12px; align-items: center">
              <label
                style="
                  display: flex;
                  align-items: center;
                  gap: 6px;
                  font-size: 13px;
                  cursor: pointer;
                "
              >
                <input type="checkbox" id="fetchUseVariables" checked />
                <span>Use Variables</span>
              </label>
              <button
                id="editFetchBtn"
                class="btn-secondary"
                style="padding: 6px 12px; font-size: 13px"
              >
                <i class="fas fa-edit"></i> Edit
              </button>
            </div>
          </div>
          <div style="position: relative">
            <textarea
              id="fetchCommandText"
              readonly
              style="
                background: var(--bg-secondary);
                padding: 16px;
                padding-top: 40px;
                border-radius: 4px;
                overflow-x: auto;
                margin: 0;
                font-family: 'Courier New', monospace;
                font-size: 13px;
                line-height: 1.5;
                border: 1px solid var(--border-color);
                width: 100%;
                min-height: 250px;
                resize: vertical;
                color: var(--text-primary-color);
              "
            ></textarea>
            <div
              id="fetchVariablesDropdown"
              style="position: absolute; top: 8px; left: 8px; display: none"
            >
              <select
                id="fetchVariableSelect"
                style="
                  padding: 4px 8px;
                  font-size: 12px;
                  border-radius: 4px;
                  border: 1px solid var(--border-color);
                  background: var(--surface-color);
                  color: var(--text-primary-color);
                  cursor: pointer;
                "
              >
                <option value="">Insert Variable...</option>
              </select>
            </div>
            <button
              id="copyFetchBtn"
              class="btn-icon"
              style="
                position: absolute;
                top: 8px;
                right: 8px;
                background: var(--primary-color);
                color: white;
                padding: 8px 12px;
                border-radius: 4px;
              "
              title="Copy to clipboard"
            >
              <i class="fas fa-copy"></i> Copy
            </button>
            <button
              id="saveFetchBtn"
              class="btn-icon"
              style="
                position: absolute;
                top: 8px;
                right: 160px;
                background: var(--success-color);
                color: white;
                padding: 8px 12px;
                border-radius: 4px;
                display: none;
              "
            >
              <i class="fas fa-save"></i> Save
            </button>
            <button
              id="runFetchBtn"
              class="btn-icon"
              style="
                position: absolute;
                top: 8px;
                right: 80px;
                background: var(--success-color);
                color: white;
                padding: 8px 12px;
                border-radius: 4px;
              "
              title="Execute request"
            >
              <i class="fas fa-play"></i> Run
            </button>
          </div>

          <!-- Response Section -->
          <div
            id="fetchResponseSection"
            style="display: none; margin-top: 20px"
          >
            <div
              style="
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 8px;
              "
            >
              <h4 style="margin: 0; color: var(--text-primary)">
                <i class="fas fa-reply"></i> Response
              </h4>
              <span
                id="fetchResponseStatus"
                style="font-size: 12px; padding: 4px 8px; border-radius: 4px"
              ></span>
            </div>
            <pre
              id="fetchResponseText"
              style="
                background: var(--bg-secondary);
                padding: 16px;
                border-radius: 4px;
                overflow: auto;
                max-height: 300px;
                margin: 0;
                font-family: 'Courier New', monospace;
                font-size: 12px;
                line-height: 1.5;
                border: 1px solid var(--border-color);
              "
            ></pre>
          </div>
        </div>
      </div>
    </div>

    <!-- Variable Editor Modal -->
    <div id="variableEditorModal" class="modal">
      <div class="modal-content" style="max-width: 500px">
        <div class="modal-header">
          <h3 id="variableEditorTitle">Add Variable</h3>
          <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="variableName">Variable Name *</label>
            <input
              type="text"
              id="variableName"
              placeholder="e.g., API_TOKEN"
              pattern="[A-Za-z_][A-Za-z0-9_]*"
              title="Use only letters, numbers, and underscores. Must start with a letter or underscore."
              required
            />
            <small
              >Use uppercase letters, numbers, and underscores (e.g., API_TOKEN,
              BASE_URL)</small
            >
          </div>
          <div class="form-group">
            <label for="variableValue">Value *</label>
            <input
              type="text"
              id="variableValue"
              placeholder="e.g., your-secret-token-here"
              required
            />
            <small>The actual value that will replace ${VAR_NAME}</small>
          </div>
          <div class="form-group">
            <label for="variableDescription">Description (optional)</label>
            <textarea
              id="variableDescription"
              rows="2"
              placeholder="e.g., Production API authentication token"
            ></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button id="cancelVariableBtn" class="secondary-btn">Cancel</button>
          <button id="saveVariableBtn" class="btn-primary">
            <i class="fas fa-save"></i> Save
          </button>
        </div>
      </div>
    </div>

    <!-- Request Runner Configuration Modal -->
    <div id="runnerConfigModal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 600px">
        <div class="modal-header">
          <h2><i class="fas fa-play-circle"></i> Configure Request Runner</h2>
          <button class="modal-close" id="closeRunnerConfigModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <p style="margin-bottom: 20px; color: var(--text-secondary-color)">
            Run <strong id="runnerRequestCount">0</strong> selected requests
            with configurable options.
          </p>

          <!-- Runner Name & Description -->
          <div class="form-group">
            <label>
              <i class="fas fa-signature"></i> Runner Name (optional)
            </label>
            <input
              type="text"
              id="runnerName"
              placeholder="e.g., Quick API Test"
              class="filter-select"
              style="width: 100%"
            />
            <small>Give this runner a name to save and reuse it later.</small>
          </div>

          <div class="form-group">
            <label>
              <i class="fas fa-comment-alt"></i> Description (optional)
            </label>
            <textarea
              id="runnerDescription"
              rows="2"
              placeholder="Describe what this runner does..."
              style="
                width: 100%;
                font-family: inherit;
                font-size: 14px;
                padding: 8px;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                background: var(--surface-color);
              "
            ></textarea>
            <small>Add notes about this runner's purpose.</small>
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" id="runnerSaveAsPermanent" />
              <span><strong>Save as Permanent Runner</strong></span>
            </label>
            <small
              >Keep this runner in your library for future use. Unchecked
              runners are temporary and auto-deleted after 7 days.</small
            >
          </div>

          <hr
            style="
              border: none;
              border-top: 1px solid var(--border-color);
              margin: 20px 0;
            "
          />

          <div class="form-group">
            <label> <i class="fas fa-bolt"></i> Execution Mode </label>
            <select id="runnerMode" class="filter-select" style="width: 100%">
              <option value="sequential">Sequential (one at a time)</option>
              <option value="parallel">Parallel (all at once)</option>
            </select>
            <small
              >Sequential runs requests in order with delays. Parallel executes
              all simultaneously.</small
            >
          </div>

          <div class="form-group" id="runnerDelayGroup">
            <label>
              <i class="fas fa-clock"></i> Delay Between Requests (ms)
            </label>
            <input
              type="number"
              id="runnerDelay"
              value="1000"
              min="0"
              step="100"
              class="filter-select"
              style="width: 100%"
            />
            <small
              >Time to wait between each request (only for sequential
              mode).</small
            >
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" id="runnerFollowRedirects" checked />
              <span>Follow Redirects</span>
            </label>
            <small>Automatically follow HTTP 3xx redirects.</small>
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" id="runnerValidateStatus" />
              <span>Validate Status Codes</span>
            </label>
            <small>Mark requests with 4xx/5xx status as failures.</small>
          </div>

          <div class="form-group">
            <label>
              <i class="fas fa-code"></i> Custom Headers (optional)
            </label>
            <textarea
              id="runnerHeaders"
              rows="4"
              placeholder='{"Authorization": "Bearer YOUR_TOKEN", "X-Custom-Header": "value"}'
              style="
                width: 100%;
                font-family: monospace;
                font-size: 13px;
                padding: 8px;
                border: 1px solid var(--border-color);
                border-radius: 4px;
                background: var(--surface-color);
              "
            ></textarea>
            <small
              >JSON object of headers to add/override. Leave empty to use
              original headers.</small
            >
          </div>

          <div class="form-group">
            <label>
              <input type="checkbox" id="runnerUseVariables" checked />
              <span>Use Variables</span>
            </label>
            <small
              >Automatically substitute ${VAR_NAME} placeholders with actual
              values from Variables Manager.</small
            >
          </div>

          <!-- Variables Preview -->
          <div
            id="runnerVariablesPreview"
            style="
              display: none;
              padding: 12px;
              background: var(--surface-color);
              border: 1px solid var(--border-color);
              border-radius: 6px;
              margin-bottom: 16px;
            "
          >
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
              "
            >
              <strong style="font-size: 14px"
                ><i class="fas fa-dollar-sign"></i> Available Variables</strong
              >
              <span
                style="font-size: 12px; color: var(--text-secondary-color)"
                id="runnerVariableCount"
                >0 variables</span
              >
            </div>
            <div
              id="runnerVariablesList"
              style="
                max-height: 150px;
                overflow-y: auto;
                font-size: 13px;
                font-family: monospace;
              "
            >
              <!-- Variables will be populated here -->
            </div>
          </div>

          <div
            style="
              padding: 12px;
              background: var(--warning-light, #fff3cd);
              border: 1px solid var(--warning-color, #ffc107);
              border-radius: 6px;
              margin-top: 16px;
            "
          >
            <p style="margin: 0; font-size: 14px">
              <i
                class="fas fa-exclamation-triangle"
                style="color: var(--warning-color, #ffc107)"
              ></i>
              <strong>Warning:</strong> This will send real HTTP requests to the
              original URLs. Be careful when replaying requests to production
              APIs.
            </p>
          </div>
        </div>
        <div class="modal-footer">
          <button id="cancelRunnerBtn" class="secondary-btn">Cancel</button>
          <button id="startRunnerBtn" class="btn-primary">
            <i class="fas fa-play"></i> Start Runner
          </button>
        </div>
      </div>
    </div>

    <!-- Runner Creation Wizard Modal -->
    <div id="runnerWizardModal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 700px">
        <div class="modal-header">
          <h2><i class="fas fa-magic"></i> Create Runner</h2>
          <button class="modal-close" id="closeRunnerWizard">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <!-- Wizard Progress -->
        <div
          style="
            padding: 20px 30px 0;
            border-bottom: 1px solid var(--border-color);
          "
        >
          <div
            style="
              display: flex;
              justify-content: space-between;
              margin-bottom: 16px;
            "
          >
            <div class="wizard-step active" data-step="1">
              <div class="wizard-step-number">1</div>
              <div class="wizard-step-label">Source</div>
            </div>
            <div class="wizard-step" data-step="2">
              <div class="wizard-step-number">2</div>
              <div class="wizard-step-label">Configure</div>
            </div>
            <div class="wizard-step" data-step="3">
              <div class="wizard-step-number">3</div>
              <div class="wizard-step-label">Edit</div>
            </div>
            <div class="wizard-step" data-step="4">
              <div class="wizard-step-number">4</div>
              <div class="wizard-step-label">Review</div>
            </div>
          </div>
        </div>

        <div class="modal-body" style="min-height: 400px; padding: 30px">
          <!-- Step 1: Source Selection -->
          <div id="wizardStep1" class="wizard-content active">
            <h3 style="margin-top: 0">Select Request Source</h3>

            <div class="form-group">
              <label
                style="
                  display: flex;
                  align-items: center;
                  font-size: 16px;
                  margin-bottom: 20px;
                "
              >
                <input
                  type="radio"
                  name="sourceType"
                  value="captured"
                  checked
                  style="margin-right: 10px; width: 18px; height: 18px"
                />
                <strong>From Captured Requests</strong>
              </label>

              <div id="capturedSourceFilters" style="margin-left: 30px">
                <div class="form-group">
                  <label><i class="fas fa-globe"></i> Domain</label>
                  <select
                    id="wizardDomainSelect"
                    class="filter-select"
                    style="width: 100%"
                  >
                    <option value="">Loading domains...</option>
                  </select>
                  <small>Select which domain's requests to include</small>
                </div>

                <div class="form-group">
                  <label><i class="fas fa-file"></i> Page URL (optional)</label>
                  <select
                    id="wizardPageSelect"
                    class="filter-select"
                    style="width: 100%"
                    disabled
                  >
                    <option value="">All pages</option>
                  </select>
                  <small>Filter by specific page</small>
                </div>

                <div class="form-group">
                  <label><i class="fas fa-filter"></i> Request Type</label>
                  <select
                    id="wizardTypeSelect"
                    class="filter-select"
                    style="width: 100%"
                    disabled
                  >
                    <option value="">All types</option>
                    <option value="xhr">XHR</option>
                    <option value="fetch">Fetch</option>
                    <option value="script">Script</option>
                    <option value="stylesheet">Stylesheet</option>
                  </select>
                  <small>Filter by request type</small>
                </div>

                <div class="form-group">
                  <label><i class="fas fa-list"></i> Select Requests</label>
                  <div
                    id="wizardRequestList"
                    style="
                      border: 1px solid var(--border-color);
                      border-radius: 4px;
                      max-height: 250px;
                      overflow-y: auto;
                      background: var(--surface-color);
                    "
                  >
                    <div
                      style="
                        padding: 20px;
                        text-align: center;
                        color: var(--text-secondary);
                      "
                    >
                      Select a domain to view available requests
                    </div>
                  </div>
                  <small id="wizardRequestCount">0 requests selected</small>
                </div>
              </div>
            </div>

            <div class="form-group" style="margin-top: 20px">
              <label
                style="
                  display: flex;
                  align-items: center;
                  font-size: 16px;
                  opacity: 0.5;
                "
              >
                <input
                  type="radio"
                  name="sourceType"
                  value="manual"
                  disabled
                  style="margin-right: 10px; width: 18px; height: 18px"
                />
                <strong>Manual Definition</strong>
                <span
                  style="
                    margin-left: 8px;
                    font-size: 12px;
                    color: var(--text-secondary);
                  "
                  >(Coming soon)</span
                >
              </label>
            </div>
          </div>

          <!-- Step 2: Configuration -->
          <div id="wizardStep2" class="wizard-content" style="display: none">
            <h3 style="margin-top: 0">Execution Configuration</h3>

            <div class="form-group">
              <label><i class="fas fa-bolt"></i> Execution Mode</label>
              <select id="wizardMode" class="filter-select" style="width: 100%">
                <option value="sequential">Sequential (one at a time)</option>
                <option value="parallel">Parallel (all at once)</option>
              </select>
            </div>

            <div class="form-group" id="wizardDelayGroup">
              <label
                ><i class="fas fa-clock"></i> Delay Between Requests (ms)</label
              >
              <input
                type="number"
                id="wizardDelay"
                value="1000"
                min="0"
                step="100"
                class="filter-select"
                style="width: 100%"
              />
            </div>

            <div class="form-group">
              <label>
                <input type="checkbox" id="wizardFollowRedirects" checked />
                <span>Follow Redirects</span>
              </label>
            </div>

            <div class="form-group">
              <label>
                <input type="checkbox" id="wizardValidateStatus" />
                <span>Validate Status Codes (200-399)</span>
              </label>
            </div>

            <div class="form-group">
              <label>
                <input type="checkbox" id="wizardUseVariables" checked />
                <span>Use Variables</span>
              </label>
            </div>
          </div>

          <!-- Step 3: Edit Requests & Variables -->
          <div id="wizardStep3" class="wizard-content" style="display: none">
            <h3 style="margin-top: 0">Edit Requests & Variables</h3>

            <!-- Variables Section -->
            <div class="form-group" id="wizardVariablesSection">
              <div
                style="
                  display: flex;
                  justify-content: space-between;
                  align-items: center;
                  margin-bottom: 12px;
                "
              >
                <label style="margin: 0"
                  ><i class="fas fa-code"></i> Variables</label
                >
                <button
                  id="btnAddVariable"
                  class="primary-btn"
                  style="padding: 4px 12px; font-size: 13px"
                >
                  <i class="fas fa-plus"></i> Add Variable
                </button>
              </div>
              <div
                id="wizardVariablesList"
                style="
                  border: 1px solid var(--border-color);
                  border-radius: 4px;
                  padding: 12px;
                  background: var(--surface-color);
                  margin-bottom: 20px;
                  max-height: 150px;
                  overflow-y: auto;
                "
              >
                <div
                  style="
                    text-align: center;
                    color: var(--text-secondary);
                    padding: 8px;
                  "
                >
                  No variables defined. Click "Add Variable" to create one.
                </div>
              </div>
              <small
                >Variables can be used in URLs, headers, and body using
                {{variableName}} syntax</small
              >
            </div>

            <!-- Requests Editor -->
            <div class="form-group">
              <label><i class="fas fa-edit"></i> Edit Requests</label>
              <div
                id="wizardRequestsEditor"
                style="
                  border: 1px solid var(--border-color);
                  border-radius: 4px;
                  max-height: 300px;
                  overflow-y: auto;
                  background: var(--surface-color);
                "
              >
                <!-- Will be populated dynamically -->
              </div>
            </div>
          </div>

          <!-- Step 4: Name & Save -->
          <div id="wizardStep4" class="wizard-content" style="display: none">
            <h3 style="margin-top: 0">Name Your Runner</h3>

            <div class="form-group">
              <label><i class="fas fa-signature"></i> Runner Name *</label>
              <input
                type="text"
                id="wizardRunnerName"
                placeholder="e.g., GitHub API Test"
                class="filter-select"
                style="width: 100%"
              />
              <small>Give your runner a descriptive name</small>
            </div>

            <div class="form-group">
              <label><i class="fas fa-comment-alt"></i> Description</label>
              <textarea
                id="wizardRunnerDescription"
                rows="3"
                placeholder="Describe what this runner does..."
                style="
                  width: 100%;
                  padding: 8px;
                  border: 1px solid var(--border-color);
                  border-radius: 4px;
                  background: var(--surface-color);
                  font-family: inherit;
                "
              ></textarea>
            </div>

            <div class="form-group">
              <label>
                <input type="checkbox" id="wizardSaveAsPermanent" checked />
                <span><strong>Save as Permanent Runner</strong></span>
              </label>
              <small
                >Uncheck to create a temporary runner (auto-deleted after 7
                days)</small
              >
            </div>
          </div>
        </div>

        <div
          class="modal-footer"
          style="display: flex; justify-content: space-between"
        >
          <button
            id="wizardPrevBtn"
            class="secondary-btn"
            style="display: none"
          >
            <i class="fas fa-arrow-left"></i> Previous
          </button>
          <div style="flex: 1"></div>
          <button id="wizardCancelBtn" class="secondary-btn">Cancel</button>
          <button id="wizardNextBtn" class="btn-primary">
            Next <i class="fas fa-arrow-right"></i>
          </button>
          <button
            id="wizardCreateBtn"
            class="btn-primary"
            style="display: none"
          >
            <i class="fas fa-check"></i> Create Runner
          </button>
        </div>
      </div>
    </div>

    <!-- Runner Details Modal -->
    <div id="runnerDetailsModal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 900px; max-height: 80vh">
        <div class="modal-header">
          <h2><i class="fas fa-info-circle"></i> Runner Details</h2>
          <button class="modal-close">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body" style="overflow-y: auto">
          <!-- Content populated by JavaScript -->
        </div>
        <div class="modal-footer">
          <button class="secondary-btn close-modal-btn">Close</button>
        </div>
      </div>
    </div>

    <!-- Request Runner Progress Modal -->
    <div id="runnerProgressModal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 700px">
        <div class="modal-header">
          <h2>
            <i id="runnerProgressIcon" class="fas fa-spinner fa-pulse"></i>
            Request Runner Progress
          </h2>
          <button class="modal-close" id="closeRunnerProgressModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <!-- Progress Stats -->
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
              gap: 16px;
              margin-bottom: 20px;
            "
          >
            <div
              style="
                padding: 16px;
                background: var(--surface-color);
                border: 1px solid var(--border-color);
                border-radius: 8px;
                text-align: center;
              "
            >
              <div
                style="
                  font-size: 28px;
                  font-weight: 700;
                  color: var(--primary-color);
                "
                id="runnerProgressPercent"
              >
                0%
              </div>
              <div
                style="
                  font-size: 12px;
                  color: var(--text-secondary-color);
                  margin-top: 4px;
                "
              >
                Progress
              </div>
            </div>
            <div
              style="
                padding: 16px;
                background: var(--surface-color);
                border: 1px solid var(--border-color);
                border-radius: 8px;
                text-align: center;
              "
            >
              <div
                style="
                  font-size: 28px;
                  font-weight: 700;
                  color: var(--success-color);
                "
                id="runnerSuccessCount"
              >
                0
              </div>
              <div
                style="
                  font-size: 12px;
                  color: var(--text-secondary-color);
                  margin-top: 4px;
                "
              >
                Successful
              </div>
            </div>
            <div
              style="
                padding: 16px;
                background: var(--surface-color);
                border: 1px solid var(--border-color);
                border-radius: 8px;
                text-align: center;
              "
            >
              <div
                style="
                  font-size: 28px;
                  font-weight: 700;
                  color: var(--error-color);
                "
                id="runnerFailureCount"
              >
                0
              </div>
              <div
                style="
                  font-size: 12px;
                  color: var(--text-secondary-color);
                  margin-top: 4px;
                "
              >
                Failed
              </div>
            </div>
            <div
              style="
                padding: 16px;
                background: var(--surface-color);
                border: 1px solid var(--border-color);
                border-radius: 8px;
                text-align: center;
              "
            >
              <div
                style="
                  font-size: 28px;
                  font-weight: 700;
                  color: var(--text-color);
                "
                id="runnerElapsedTime"
              >
                0s
              </div>
              <div
                style="
                  font-size: 12px;
                  color: var(--text-secondary-color);
                  margin-top: 4px;
                "
              >
                Elapsed Time
              </div>
            </div>
          </div>

          <!-- Progress Bar -->
          <div style="margin-bottom: 20px">
            <div
              style="
                display: flex;
                justify-content: space-between;
                margin-bottom: 8px;
              "
            >
              <span id="runnerProgressText">Preparing...</span>
              <span id="runnerProgressCount">0 / 0</span>
            </div>
            <div
              style="
                width: 100%;
                height: 8px;
                background: var(--surface-color);
                border-radius: 4px;
                overflow: hidden;
              "
            >
              <div
                id="runnerProgressBar"
                style="
                  width: 0%;
                  height: 100%;
                  background: var(--primary-color);
                  transition: width 0.3s;
                "
              ></div>
            </div>
          </div>

          <!-- Current Request -->
          <div
            id="runnerCurrentRequest"
            style="
              padding: 12px;
              background: var(--surface-color);
              border: 1px solid var(--border-color);
              border-radius: 6px;
              margin-bottom: 16px;
              display: none;
            "
          >
            <div style="font-weight: 600; margin-bottom: 8px">
              Current Request:
            </div>
            <div style="display: flex; gap: 8px; align-items: center">
              <span class="method-badge" id="runnerCurrentMethod">GET</span>
              <span
                style="
                  flex: 1;
                  font-size: 13px;
                  color: var(--text-secondary-color);
                  overflow: hidden;
                  text-overflow: ellipsis;
                  white-space: nowrap;
                "
                id="runnerCurrentUrl"
              ></span>
            </div>
          </div>

          <!-- Results Table -->
          <div
            style="
              max-height: 300px;
              overflow-y: auto;
              border: 1px solid var(--border-color);
              border-radius: 6px;
            "
          >
            <table class="data-table" style="width: 100%; margin: 0">
              <thead
                style="
                  position: sticky;
                  top: 0;
                  background: var(--surface-color);
                  z-index: 1;
                "
              >
                <tr>
                  <th style="width: 40px">#</th>
                  <th style="width: 80px">Method</th>
                  <th>URL</th>
                  <th style="width: 80px">Status</th>
                  <th style="width: 100px">Time</th>
                </tr>
              </thead>
              <tbody id="runnerResultsTableBody">
                <tr>
                  <td
                    colspan="5"
                    style="
                      text-align: center;
                      padding: 16px;
                      color: var(--text-secondary-color);
                    "
                  >
                    Waiting for results...
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer">
          <button id="cancelRunnerProgressBtn" class="btn-error">
            <i class="fas fa-stop"></i> Cancel Run
          </button>
          <button
            id="closeRunnerResultsBtn"
            class="btn-primary"
            style="display: none"
          >
            <i class="fas fa-check"></i> Done
          </button>
        </div>
      </div>
    </div>

    <!-- Runner History Modal -->
    <div id="runnerHistoryModal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 800px">
        <div class="modal-header">
          <h2><i class="fas fa-history"></i> Runner History</h2>
          <button class="modal-close" id="closeRunnerHistoryModal">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div id="runnerHistoryContainer"></div>
        </div>
        <div class="modal-footer">
          <button id="closeHistoryBtn" class="secondary-btn">Close</button>
        </div>
      </div>
    </div>

    <!-- Collection Edit Modal -->
    <div id="collectionModal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 600px">
        <div class="modal-header">
          <h2 id="collectionModalTitle">
            <i class="fas fa-folder"></i> Create Collection
          </h2>
          <button class="modal-close" id="collectionModalClose">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="collectionId" />

          <div class="form-group">
            <label for="collectionName">Collection Name *</label>
            <input
              type="text"
              id="collectionName"
              class="form-control"
              placeholder="e.g., API Test Suite"
              required
            />
          </div>

          <div class="form-group">
            <label for="collectionDescription">Description</label>
            <textarea
              id="collectionDescription"
              class="form-control"
              rows="3"
              placeholder="Optional description..."
            ></textarea>
          </div>

          <div
            class="form-row"
            style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px"
          >
            <div class="form-group">
              <label for="collectionColor">Color</label>
              <input
                type="color"
                id="collectionColor"
                class="form-control"
                value="#007bff"
              />
            </div>

            <div class="form-group">
              <label for="collectionIcon">Icon Class</label>
              <input
                type="text"
                id="collectionIcon"
                class="form-control"
                placeholder="fa-folder"
                value="fa-folder"
              />
              <small class="form-text"
                >FontAwesome icon class (e.g., fa-folder, fa-rocket)</small
              >
            </div>
          </div>

          <div class="form-group">
            <label for="collectionRunners">Runners in this Collection</label>
            <div id="collectionRunnersList" class="runner-selection-list">
              <div
                style="
                  text-align: center;
                  padding: 20px;
                  color: var(--text-secondary);
                "
              >
                <i class="fas fa-spinner fa-spin"></i> Loading runners...
              </div>
            </div>
            <small class="form-text"
              >Select runners to include in this collection</small
            >
          </div>
        </div>
        <div class="modal-footer">
          <button id="btnCancelCollection" class="secondary-btn">Cancel</button>
          <button id="btnSaveCollection" class="btn-primary">
            <i class="fas fa-save"></i> Save Collection
          </button>
        </div>
      </div>
    </div>

    <!-- Collection View Modal -->
    <div id="collectionViewModal" class="modal" style="display: none">
      <div class="modal-content" style="max-width: 700px">
        <!-- Content will be dynamically generated -->
      </div>
    </div>

    <script type="module" src="options.js"></script>
  </body>
</html>
