<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Universal Request Analyzer</title>
  <link rel="stylesheet" href="../css/themes.css">
  <link rel="stylesheet" href="../assets/fontawesome/css/all.min.css">
  <link rel="stylesheet" href="./css/popup.css">
  <script src="../lib/shared-theme-init.js"></script>
  <script src="../lib/chart.min.js"></script>
</head>
<body>
  <!-- Main App -->
  <div id="appContainer" class="app-container">
    <!-- Header Bar -->
    <div class="header-bar">
      <div class="header-title">
        <img src="../assets/icons/icon128.png" alt="Universal Request Analyzer" class="header-logo">
        <span class="header-text">Request Analyzer</span>
      </div>
      <div class="header-actions">
        <button id="refreshSettingsBtn" class="action-btn" title="Refresh data (Ctrl+R)" aria-label="Refresh data">
          <i class="fas fa-sync-alt" aria-hidden="true"></i>
        </button>
        <button id="helpBtn" class="action-btn" title="Help & Documentation" aria-label="Open help">
          <i class="fas fa-question-circle" aria-hidden="true"></i>
        </button>
      </div>
    </div>

    <!-- Mode Toggle -->
    <div class="mode-toggle">
      <button id="simpleModeBtn" class="mode-btn active" data-mode="simple" aria-label="Switch to simple mode" title="Simple mode shows key metrics">
        <i class="fas fa-th-large" aria-hidden="true"></i> Simple
      </button>
      <button id="advancedModeBtn" class="mode-btn" data-mode="advanced" aria-label="Switch to advanced mode" title="Advanced mode shows detailed analytics">
        <i class="fas fa-cogs" aria-hidden="true"></i> Advanced
      </button>
      <button id="whatsNewBtn" class="mode-btn whats-new-btn" title="See what's new" aria-label="What's new">
        <i class="fas fa-star" aria-hidden="true"></i>
        <span class="new-badge">New</span>
      </button>
    </div>

    <!-- Resource Usage Display -->
    <div id="resourceUsage" class="resource-usage" style="display: none;">
      <div class="resource-item">
        <span class="resource-label"><i class="fas fa-database"></i> Requests:</span>
        <span class="resource-value" id="requestCount">0 / 10,000</span>
      </div>
      <div class="resource-item">
        <span class="resource-label"><i class="fas fa-hdd"></i> Storage:</span>
        <span class="resource-value" id="storageSize">0 MB</span>
      </div>
    </div>

    <!-- Quick Filter Chips -->
    <div class="quick-filters">
      <button class="filter-chip active" data-filter="all">
        <i class="fas fa-globe"></i> All
      </button>
      <button class="filter-chip" data-filter="2xx">
        <i class="fas fa-check-circle"></i> 2xx
      </button>
      <button class="filter-chip" data-filter="4xx">
        <i class="fas fa-exclamation-triangle"></i> 4xx
      </button>
      <button class="filter-chip" data-filter="5xx">
        <i class="fas fa-times-circle"></i> 5xx
      </button>
      <button class="filter-chip" data-filter="xhr">
        <i class="fas fa-exchange-alt"></i> XHR
      </button>
    </div>

    <!-- Search Bar -->
    <div class="search-bar">
      <div class="search-input-wrapper">
        <i class="fas fa-search search-icon"></i>
        <input 
          type="text" 
          id="searchInput" 
          placeholder="Search requests by URL, method, or status..."
          autocomplete="off"
        />
        <button id="clearSearchBtn" class="clear-search-btn" title="Clear search">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <!-- Export Actions -->
    <div class="export-actions">
      <button id="exportHARBtn" class="export-btn" title="Export as HAR (HTTP Archive)">
        <i class="fas fa-download"></i> Export HAR
      </button>
      <button id="exportJSONBtn" class="export-btn" title="Export as JSON">
        <i class="fas fa-file-code"></i> JSON
      </button>
      <button id="exportCSVBtn" class="export-btn" title="Export as CSV">
        <i class="fas fa-file-csv"></i> CSV
      </button>
      <button id="shareReportBtn" class="export-btn share-btn" title="Generate shareable report">
        <i class="fas fa-share-alt"></i> Share
      </button>
    </div>

    <!-- Filters Section - Collapsible -->
    <details class="filters-section">
      <summary class="filters-toggle">
        <i class="fas fa-sliders-h"></i> Advanced Filters
      </summary>
      <div class="filters-bar">
        <div class="filter-group">
          <label for="pageFilter"><i class="fas fa-file"></i> Page:</label>
          <select id="pageFilter" class="filter-select">
            <option value="">All Pages in Domain</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="requestTypeFilter"><i class="fas fa-filter"></i> Type:</label>
          <select id="requestTypeFilter" class="filter-select">
            <option value="">All Types</option>
            <option value="xmlhttprequest">XHR/API</option>
            <option value="fetch">Fetch</option>
            <option value="script">Scripts</option>
            <option value="stylesheet">Stylesheets</option>
            <option value="image">Images</option>
            <option value="font">Fonts</option>
            <option value="document">Documents</option>
            <option value="other">Other</option>
          </select>
        </div>
      </div>
    </details>

    <!-- Page Summary -->
    <div class="page-summary">
      <div class="summary-title">
        <i class="fas fa-chart-line"></i> <span id="currentDomainDisplay">Loading...</span>
      </div>
      
      <div class="summary-stats">
        <div class="stat-item">
          <div class="stat-label">Total Requests</div>
          <div class="stat-value" id="totalRequests">0</div>
          <div class="stat-trend" id="requestsTrend"></div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Avg Response</div>
          <div class="stat-value" id="avgResponse">0ms</div>
          <div class="stat-trend" id="responseTrend"></div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Errors</div>
          <div class="stat-value" id="errorCount">0</div>
          <div class="stat-trend" id="errorTrend"></div>
        </div>
        <div class="stat-item">
          <div class="stat-label">Data Transferred</div>
          <div class="stat-value" id="dataTransferred">0KB</div>
          <div class="stat-trend" id="dataTrend"></div>
        </div>
      </div>

      <!-- Request Timeline Chart -->
      <div class="timeline-chart">
        <div class="chart-title">Request Timeline (Last 5 min)</div>
        <canvas id="requestTimelineChart" width="400" height="200"></canvas>
      </div>

      <!-- Status Breakdown -->
      <div class="status-breakdown">
        <div class="breakdown-title">Status Codes</div>
        <div class="status-grid">
          <div class="status-badge success">
            <span class="status-label">2xx</span>
            <span class="status-count" id="status2xx">0</span>
          </div>
          <div class="status-badge redirect">
            <span class="status-label">3xx</span>
            <span class="status-count" id="status3xx">0</span>
          </div>
          <div class="status-badge client-error">
            <span class="status-label">4xx</span>
            <span class="status-count" id="status4xx">0</span>
          </div>
          <div class="status-badge server-error">
            <span class="status-label">5xx</span>
            <span class="status-count" id="status5xx">0</span>
          </div>
        </div>
      </div>

      <!-- Request Types -->
      <div class="request-types">
        <div class="breakdown-title">Request Types</div>
        <div class="types-list" id="requestTypesList">
          <div class="type-item">
            <span class="type-name">XHR</span>
            <span class="type-bar"><span class="type-bar-fill"></span></span>
            <span class="type-count">0</span>
          </div>
        </div>
      </div>

      <!-- Recent Errors (Max 5) -->
      <div class="recent-errors">
        <div class="breakdown-title">
          <i class="fas fa-exclamation-triangle"></i> Recent Errors (Last 5)
        </div>
        <div class="errors-list" id="recentErrorsList">
          <p class="placeholder">No errors in the last 5 minutes</p>
        </div>
      </div>

      <!-- Recent Requests List -->
      <div class="recent-requests">
        <div class="breakdown-title">
          <i class="fas fa-list"></i> Recent Requests (Last 10)
          <button id="clearRecentBtn" class="clear-btn" title="Clear requests">
            <i class="fas fa-trash-alt"></i>
          </button>
        </div>
        <div class="requests-list" id="recentRequestsList">
          <p class="placeholder">No requests captured yet</p>
        </div>
      </div>

      <!-- Performance Insights -->
      <div class="performance-insights">
        <div class="breakdown-title">
          <i class="fas fa-lightbulb"></i> Performance Insights
        </div>
        <div class="insights-list" id="insightsList">
          <p class="placeholder">Analyzing performance...</p>
        </div>
      </div>
    </div>

    <!-- QA Quick View -->
    <div class="qa-quick-view">
      <div class="qa-header">
        <i class="fas fa-search"></i> QA Quick View
      </div>
      <div class="site-selector">
        <label for="siteSelect">Select Site:</label>
        <select id="siteSelect">
          <option value="">Current Page</option>
        </select>
      </div>
      <div class="qa-navigation">
        <button class="qa-nav-btn" id="viewRequests">
          <i class="fas fa-list"></i> View Requests
        </button>
        <button class="qa-nav-btn" id="viewAnalytics">
          <i class="fas fa-chart-bar"></i> Analytics
        </button>
        <button class="qa-nav-btn" id="exportData">
          <i class="fas fa-download"></i> Export
        </button>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <button class="action-btn" id="openDevtools">
        <i class="fas fa-chart-line"></i>
        <span>Analytics</span>
      </button>
      <button class="action-btn" id="openDashboard">
        <i class="fas fa-th-large"></i>
        <span>Dashboard</span>
      </button>
      <button class="action-btn" id="openHelp">
        <i class="fas fa-question-circle"></i>
        <span>Help</span>
      </button>
    </div>

    <!-- Footer -->
    <div class="footer-info">
      Extension v1.0.0 • <a href="#" id="viewPrivacy">Privacy</a> • <a href="#" id="reportIssue">Report Issue</a>
    </div>
  </div>

  <!-- Modal for What's New / Help -->
  <div id="modal" class="modal" style="display: none;" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">What's New</h2>
        <button id="closeModal" class="close-modal-btn" aria-label="Close modal">
          <i class="fas fa-times" aria-hidden="true"></i>
        </button>
      </div>
      <div class="modal-body" id="modalBody">
        <!-- Dynamic content -->
      </div>
      <div class="modal-footer">
        <button id="modalActionBtn" class="modal-action-btn">Got it!</button>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
